<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URC Fantasy League - Simple Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">üèâ URC Fantasy League</h1>
            <p class="text-white/80">Pick a team to WIN each round - lose and you're out!</p>
        </div>

        <!-- Authentication Section -->
        <div id="authSection" class="max-w-md mx-auto bg-white rounded-xl card-shadow p-8 mb-8">
            <div class="flex mb-6 bg-gray-100 rounded-lg p-1">
                <button type="button" id="loginTab" class="flex-1 py-2 px-4 bg-blue-600 text-white rounded-md font-medium">Login</button>
                <button type="button" id="registerTab" class="flex-1 py-2 px-4 text-gray-600 rounded-md font-medium hover:bg-gray-200">Register</button>
            </div>

            <form id="authForm" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="email" name="email" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" name="password" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div id="displayNameField" class="hidden">
                    <label for="displayName" class="block text-sm font-medium text-gray-700 mb-1">Display Name</label>
                    <input type="text" id="displayName" name="displayName"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <button type="submit" id="authButton"
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 font-medium">
                    <span id="buttonText">Login</span>
                </button>
            </form>
        </div>

        <!-- Main App -->
        <div id="mainApp" class="hidden">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-800">Welcome, <span id="userName"></span>!</h2>
                        <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                            Logout
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Your Fantasy League</h3>

                    <div class="bg-blue-50 rounded-lg p-4 mb-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="text-lg font-semibold text-blue-900">Round <span id="currentRound">1</span></h4>
                                <p class="text-blue-700">Pick your team for this round's matches</p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-blue-900" id="userScore">0</div>
                                <div class="text-sm text-blue-700">Rounds Survived</div>
                            </div>
                        </div>
                    </div>

                    <div id="teamSelection" class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Select Your Team</h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3" id="teamGrid">
                            <!-- Teams will be populated by JavaScript -->
                        </div>
                        <div class="mt-4">
                            <button id="submitPick" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50" disabled>
                                Submit Pick
                            </button>
                            <span id="pickStatus" class="ml-3 text-sm text-gray-600"></span>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">This Round's Matches</h4>
                        <div id="matchesList" class="space-y-3">
                            <!-- Matches will be populated by JavaScript -->
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Leaderboard</h4>
                        <div id="leaderboard" class="space-y-2">
                            <!-- Leaderboard will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Container -->
        <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let isLoginMode = true;
        let gameData = null;
        let selectedTeam = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing simple app...');
            initializeAuth();
            setupEventListeners();
            checkExistingSession();
            initializeGame();

            // Update game state every minute
            setInterval(() => {
                if (currentUser && gameData) {
                    updateGameState();
                    updateGameDisplay();
                }
            }, 60000);
        });

        // Initialize authentication system
        function initializeAuth() {
            switchAuthMode('login');
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showMainApp();
                } catch (e) {
                    localStorage.removeItem('currentUser');
                }
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Tab switching
            document.getElementById('loginTab').addEventListener('click', () => switchAuthMode('login'));
            document.getElementById('registerTab').addEventListener('click', () => switchAuthMode('register'));

            // Form submission
            document.getElementById('authForm').addEventListener('submit', handleAuthSubmit);

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);

            // Game events
            document.getElementById('submitPick').addEventListener('click', submitTeamPick);
        }

        // Switch between login and register modes
        function switchAuthMode(mode) {
            isLoginMode = mode === 'login';
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const displayNameField = document.getElementById('displayNameField');
            const buttonText = document.getElementById('buttonText');

            if (isLoginMode) {
                loginTab.className = 'flex-1 py-2 px-4 bg-blue-600 text-white rounded-md font-medium';
                registerTab.className = 'flex-1 py-2 px-4 text-gray-600 rounded-md font-medium hover:bg-gray-200';
                displayNameField.classList.add('hidden');
                buttonText.textContent = 'Login';
            } else {
                loginTab.className = 'flex-1 py-2 px-4 text-gray-600 rounded-md font-medium hover:bg-gray-200';
                registerTab.className = 'flex-1 py-2 px-4 bg-blue-600 text-white rounded-md font-medium';
                displayNameField.classList.remove('hidden');
                buttonText.textContent = 'Register';
            }
            clearForm();
        }

        function clearForm() {
            document.getElementById('authForm').reset();
            clearErrors();
        }

        function clearErrors() {
            // Clear any error messages
            const errors = document.querySelectorAll('[id$="Error"]');
            errors.forEach(el => {
                el.classList.add('hidden');
                el.textContent = '';
            });
        }

        // Handle form submission
        function handleAuthSubmit(e) {
            e.preventDefault();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const displayName = document.getElementById('displayName')?.value?.trim() || '';

            if (isLoginMode) {
                loginUser(email, password);
            } else {
                registerUser(email, password, displayName);
            }
        }

        // Login user
        function loginUser(email, password) {
            const users = getStoredUsers();
            const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());

            if (!user) {
                showNotification('No account found with this email address', 'error');
                return;
            }

            if (user.password !== hashPassword(password)) {
                showNotification('Incorrect password', 'error');
                return;
            }

            currentUser = {
                id: user.id,
                email: user.email,
                displayName: user.displayName,
                createdAt: user.createdAt
            };

            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMainApp();
            showNotification('Login successful!', 'success');
        }

        // Register user
        function registerUser(email, password, displayName) {
            const users = getStoredUsers();

            if (users.find(u => u.email.toLowerCase() === email.toLowerCase())) {
                showNotification('An account with this email already exists', 'error');
                return;
            }

            const newUser = {
                id: 'user_' + Date.now(),
                email: email.toLowerCase(),
                password: hashPassword(password),
                displayName: displayName,
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));

            currentUser = {
                id: newUser.id,
                email: newUser.email,
                displayName: newUser.displayName,
                createdAt: newUser.createdAt
            };

            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMainApp();
            showNotification('Registration successful! Welcome to URC Fantasy League!', 'success');
        }

        function showMainApp() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser.displayName;
            loadGameData();
        }

        function logout() {
            currentUser = null;
            selectedTeam = null;
            localStorage.removeItem('currentUser');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('authSection').classList.remove('hidden');
            showNotification('Logged out successfully', 'info');
        }

        function getStoredUsers() {
            const users = localStorage.getItem('users');
            return users ? JSON.parse(users) : [];
        }

        function hashPassword(password) {
            // Simple hash function for demo purposes
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString();
        }

        // Game functionality
        function initializeGame() {
            try {
                if (!localStorage.getItem('gameData')) {
                    initializeGameData();
                }
                gameData = JSON.parse(localStorage.getItem('gameData'));
                console.log('Game initialized');
            } catch (error) {
                console.error('Error initializing game:', error);
                initializeGameData();
                gameData = JSON.parse(localStorage.getItem('gameData'));
            }
        }

        function initializeGameData() {
            const teams = [
                { id: 'leinster', name: 'Leinster', country: 'Ireland' },
                { id: 'munster', name: 'Munster', country: 'Ireland' },
                { id: 'ulster', name: 'Ulster', country: 'Ireland' },
                { id: 'connacht', name: 'Connacht', country: 'Ireland' },
                { id: 'glasgow', name: 'Glasgow Warriors', country: 'Scotland' },
                { id: 'edinburgh', name: 'Edinburgh', country: 'Scotland' },
                { id: 'cardiff', name: 'Cardiff Rugby', country: 'Wales' },
                { id: 'ospreys', name: 'Ospreys', country: 'Wales' },
                { id: 'scarlets', name: 'Scarlets', country: 'Wales' },
                { id: 'dragons', name: 'Dragons', country: 'Wales' },
                { id: 'bulls', name: 'Bulls', country: 'South Africa' },
                { id: 'stormers', name: 'Stormers', country: 'South Africa' },
                { id: 'sharks', name: 'Sharks', country: 'South Africa' },
                { id: 'lions', name: 'Lions', country: 'South Africa' },
                { id: 'zebre', name: 'Zebre Parma', country: 'Italy' },
                { id: 'benetton', name: 'Benetton', country: 'Italy' }
            ];

            const fixtures = [
                { round: 1, home: 'stormers', away: 'leinster', homeScore: null, awayScore: null, completed: false, date: '2025-09-26', time: '18:00' },
                { round: 1, home: 'glasgow', away: 'sharks', homeScore: null, awayScore: null, completed: false, date: '2025-09-26', time: '20:05' }
            ];

            const gameData = {
                currentRound: 1,
                teams: teams,
                fixtures: fixtures,
                userPicks: {},
                eliminatedUsers: {},
                gameState: 'picking',
                seasonPhase: 'regular'
            };

            localStorage.setItem('gameData', JSON.stringify(gameData));
        }

        function loadGameData() {
            if (!currentUser) return;
            gameData = JSON.parse(localStorage.getItem('gameData'));
            updateGameDisplay();
        }

        function updateGameDisplay() {
            updateCurrentRound();
            updateTeamSelection();
            updateMatchesList();
            updateLeaderboard();
            updateUserScore();
        }

        function updateCurrentRound() {
            document.getElementById('currentRound').textContent = gameData.currentRound;
        }

        function updateTeamSelection() {
            const teamGrid = document.getElementById('teamGrid');
            teamGrid.innerHTML = '';

            gameData.teams.forEach(team => {
                const teamCard = document.createElement('div');
                teamCard.className = 'bg-gray-100 rounded-lg p-3 text-center cursor-pointer hover:bg-gray-200 transition-colors team-card';
                teamCard.dataset.teamId = team.id;

                teamCard.innerHTML = `
                    <div class="font-semibold text-gray-800">${team.name}</div>
                    <div class="text-sm text-gray-600">${team.country}</div>
                `;

                teamCard.addEventListener('click', () => selectTeam(team.id));
                teamGrid.appendChild(teamCard);
            });
        }

        function selectTeam(teamId) {
            // Remove previous selection
            document.querySelectorAll('.team-card').forEach(card => {
                card.classList.remove('bg-blue-200', 'border-blue-500');
            });

            // Add selection to current team
            const selectedCard = document.querySelector(`[data-team-id="${teamId}"]`);
            selectedCard.classList.add('bg-blue-200', 'border-blue-500');

            selectedTeam = teamId;
            document.getElementById('submitPick').disabled = false;
            document.getElementById('pickStatus').textContent = `Selected: ${gameData.teams.find(t => t.id === teamId).name}`;
        }

        function submitTeamPick() {
            if (!selectedTeam) return;

            // Store user's pick
            if (!gameData.userPicks[currentUser.id]) {
                gameData.userPicks[currentUser.id] = {};
            }

            gameData.userPicks[currentUser.id][gameData.currentRound] = selectedTeam;
            localStorage.setItem('gameData', JSON.stringify(gameData));

            showNotification(`Pick submitted: ${gameData.teams.find(t => t.id === selectedTeam).name}`, 'success');
            updateGameDisplay();
        }

        function updateMatchesList() {
            const matchesList = document.getElementById('matchesList');
            matchesList.innerHTML = '';

            const currentRoundFixtures = gameData.fixtures.filter(f => f.round === gameData.currentRound);

            if (currentRoundFixtures.length === 0) {
                matchesList.innerHTML = '<p class="text-gray-600">No matches scheduled for this round yet.</p>';
                return;
            }

            currentRoundFixtures.forEach(fixture => {
                const homeTeam = gameData.teams.find(t => t.id === fixture.home);
                const awayTeam = gameData.teams.find(t => t.id === fixture.away);

                const matchDiv = document.createElement('div');
                matchDiv.className = 'bg-gray-50 rounded-lg p-3';
                matchDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="flex-1 text-right">
                            <div class="font-semibold">${homeTeam.name}</div>
                            <div class="text-sm text-gray-600">${fixture.date} ${fixture.time}</div>
                        </div>
                        <div class="px-4">
                            <span class="text-2xl font-bold">vs</span>
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold">${awayTeam.name}</div>
                        </div>
                    </div>
                `;
                matchesList.appendChild(matchDiv);
            });
        }

        function updateLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            leaderboard.innerHTML = '';

            const users = getStoredUsers();
            const userScores = users.map(user => {
                const picks = gameData.userPicks[user.id] || {};
                let roundsSurvived = 0;

                for (let round = 1; round <= gameData.currentRound; round++) {
                    if (picks[round]) {
                        roundsSurvived++;
                    } else {
                        break;
                    }
                }

                return {
                    user: user,
                    roundsSurvived: roundsSurvived,
                    stillIn: roundsSurvived >= gameData.currentRound
                };
            });

            userScores.sort((a, b) => b.roundsSurvived - a.roundsSurvived);

            userScores.forEach((entry, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = `flex justify-between items-center p-3 rounded-lg ${entry.stillIn ? 'bg-green-50' : 'bg-red-50'}`;

                playerDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold mr-3">
                            ${index + 1}
                        </div>
                        <div>
                            <div class="font-semibold">${entry.user.displayName}</div>
                            <div class="text-sm ${entry.stillIn ? 'text-green-600' : 'text-red-600'}">
                                ${entry.stillIn ? 'Still in the game' : 'Eliminated'}
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-lg">${entry.roundsSurvived}</div>
                        <div class="text-sm text-gray-600">rounds survived</div>
                    </div>
                `;

                leaderboard.appendChild(playerDiv);
            });
        }

        function updateUserScore() {
            if (!currentUser || !gameData.userPicks[currentUser.id]) return;

            const picks = gameData.userPicks[currentUser.id];
            let roundsSurvived = 0;

            for (let round = 1; round <= gameData.currentRound; round++) {
                if (picks[round]) {
                    roundsSurvived++;
                }
            }

            document.getElementById('userScore').textContent = roundsSurvived;
        }

        function updateGameState() {
            // This would be more complex in the full version
            // For now, just check if we need to advance rounds
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');

            const bgColor = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'info': 'bg-blue-500',
                'warning': 'bg-yellow-500'
            }[type] || 'bg-gray-500';

            notification.className = `${bgColor} text-white px-4 py-3 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full`;
            notification.textContent = message;

            container.appendChild(notification);

            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);

            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (container.contains(notification)) {
                        container.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        console.log('Simple URC Fantasy League app loaded');
    </script>
</body>
</html>