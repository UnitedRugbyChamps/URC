<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URC Last Man Standing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .blur { filter: blur(5px); transition: filter 0.3s ease; }
        .blur-pick {
    color: transparent !important;
    text-shadow: 0 0 8px #bbb;
    background: linear-gradient(90deg, #ececec 40%, #ddd 60%);
    border-radius: 6px;
    filter: blur(6px);
    pointer-events: none;
    user-select: none;
    position: relative;
    min-width: 120px;
    min-height: 1em;
    display: inline-block;
}
.blur-pick::after {
    content: "üîí Hidden until locked";
    color: #555;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%);
    background: rgba(255,255,255,0.85);
    padding: 2px 10px;
    border-radius: 5px;
    font-size: 0.9em;
    filter: none;
    white-space: nowrap;
}
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="flex">
        

        <div class="container mx-auto px-3 sm:px-4 py-6 sm:py-8 w-full overflow-x-hidden">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-white mb-2 flex items-center justify-center gap-3">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRgMFCSXJWsbmkra95ltt9Z9LJiRuMOsIBluqwF-g4&usqp=CAE&s" alt="URC Logo" class="h-12 w-12 object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                <span style="display: none;">üèâ</span>
                URC Last Man Standing
            </h1>
            <p class="text-white/80">Pick a team each week - but you can only use each team once!</p>
        </div>

        <!-- Login/Register Form -->
        <div id="authSection" class="max-w-md mx-auto bg-white rounded-xl card-shadow p-6 mb-8">
            <div class="flex mb-4">
                <button id="loginTab" class="flex-1 py-2 px-4 bg-blue-600 text-white rounded-l-lg font-medium">Login</button>
                <button id="registerTab" class="flex-1 py-2 px-4 bg-gray-200 text-gray-700 rounded-r-lg font-medium">Register</button>
            </div>
            
            <form id="authForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Email</label>
                    <input type="email" id="email" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required minlength="6">
                    <p id="passwordHelp" class="text-xs text-gray-500 mt-1 hidden">Password must be at least 6 characters long</p>
                </div>
                

                
                <div id="nameField" class="mb-4 hidden">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Display Name</label>
                    <input type="text" id="displayName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- Profile Picture Selection -->
                <div id="profilePicField" class="mb-4 hidden">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Profile Picture (Optional)</label>
                    
                    <!-- Upload Custom Picture -->
                    <div class="mb-4 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 transition-colors">
                        <div class="text-center">
                            <div class="mb-2">
                                <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>
                            <label for="customProfilePic" class="cursor-pointer">
                                <span class="text-sm text-blue-600 hover:text-blue-500 font-medium">Upload your picture</span>
                                <input id="customProfilePic" type="file" accept="image/*" class="hidden">
                            </label>
                            <p class="text-xs text-gray-500 mt-1">JPG, PNG, GIF up to 2MB</p>
                        </div>
                        <div id="customPicPreview" class="hidden mt-3 text-center">
                            <img id="customPicImage" class="w-16 h-16 rounded-full mx-auto object-cover border-2 border-blue-500" alt="Custom profile picture">
                            <button type="button" id="removeCustomPic" class="mt-2 text-xs text-red-600 hover:text-red-800">Remove</button>
                        </div>
                    </div>
                </div>
                
                <!-- Favorite Team Selection -->
                <div id="favoriteTeamField" class="mb-4 hidden">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Favorite URC Team (Optional)</label>
                    <select id="favoriteTeam" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select your favorite team</option>
                        <option value="Benetton Rugby">Benetton Rugby</option>
                        <option value="Bulls">Bulls</option>
                        <option value="Cardiff Rugby">Cardiff Rugby</option>
                        <option value="Connacht">Connacht</option>
                        <option value="Dragons">Dragons</option>
                        <option value="Edinburgh">Edinburgh</option>
                        <option value="Glasgow Warriors">Glasgow Warriors</option>
                        <option value="Leinster">Leinster</option>
                        <option value="Lions">Lions</option>
                        <option value="Munster">Munster</option>
                        <option value="Ospreys">Ospreys</option>
                        <option value="Scarlets">Scarlets</option>
                        <option value="Sharks">Sharks</option>
                        <option value="Stormers">Stormers</option>
                        <option value="Ulster">Ulster</option>
                        <option value="Zebre">Zebre</option>
                    </select>
                </div>
                
                <button type="submit" id="authButton" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 font-medium">Login</button>
                
                <div id="forgotPasswordLink" class="text-center mt-3">
                    <button type="button" id="forgotPasswordBtn" class="text-sm text-blue-600 hover:text-blue-800 underline">Forgot Password?</button>
                </div>
            </form>
            
            <!-- Password Reset Form -->
            <div id="passwordResetForm" class="hidden mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <h4 class="font-medium text-gray-800 mb-3">üîê Password Reset</h4>
                <p class="text-sm text-gray-600 mb-3">Enter your email and display name to reset your password:</p>
                <div class="space-y-3">
                    <input type="email" id="resetEmail" placeholder="Your email address" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="text" id="resetDisplayName" placeholder="Your display name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="password" id="newPassword" placeholder="New password (min 6 characters)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" minlength="6">
                    <div class="flex space-x-2">
                        <button type="button" id="resetPasswordBtn" class="flex-1 bg-yellow-600 text-white py-2 px-4 rounded-lg hover:bg-yellow-700 font-medium">Reset Password</button>
                        <button type="button" id="cancelResetBtn" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 font-medium">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App (Hidden initially) -->
        <div id="mainApp" class="hidden">
            

            <!-- User Info & Stats -->
            <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 mb-4">
                    <div class="flex items-center space-x-3 overflow-x-auto no-scrollbar">
                        <span id="userProfilePic" class="cursor-pointer hover:scale-110 transition-transform" onclick="openProfileModal(currentUser?.id)">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRgMFCSXJWsbmkra95ltt9Z9LJiRuMOsIBluqwF-g4&usqp=CAE&s" class="w-8 h-8 rounded-full object-cover border border-gray-300" alt="Profile" onerror="this.src=''; this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="w-8 h-8 rounded-full bg-gray-300 border border-gray-400" style="display: none;"></div>
                        </span>
                        <div>
                            <h2 class="text-xl font-semibold text-gray-800">Welcome, <span id="userName"></span>!</h2>
                            <p class="text-gray-600">Round <span id="currentRound">1</span></p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button id="settingsBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">Profile</button>
                        <button id="adminScores" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 hidden">Admin Panel</button>
                        <button id="syncSettingsBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Sync</button>
                        <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Logout</button>
                    </div>
                </div>
                <div id="lmsCountdownInline" class="mt-2 text-sm text-gray-600"></div>
                
                <!-- LMS Stats -->
                <div id="lmsStats" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-green-50 p-4 rounded-lg cursor-pointer hover:bg-green-100 transition-colors" id="standingPlayersCard">
                        <div class="text-2xl font-bold text-green-600" id="playersStanding">0</div>
                        <div class="text-sm text-green-700">Players Standing</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg cursor-pointer hover:bg-red-100 transition-colors" id="eliminatedPlayersCard">
                        <div class="text-2xl font-bold text-red-600" id="playersEliminated">0</div>
                        <div class="text-sm text-red-700">Players Eliminated</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg cursor-pointer hover:bg-blue-100 transition-colors" id="viewPicksCard">
                        <div class="text-2xl font-bold text-blue-600" id="totalPlayers">0</div>
                        <div class="text-sm text-blue-700">View Picks</div>
                    </div>
                </div>

                
            </div>

            <!-- Round Status -->
            <div id="roundStatus" class="bg-white rounded-xl card-shadow p-6 mb-6">
                <div class="text-center">
                    <div id="statusMessage" class="text-lg font-medium text-gray-800 mb-2"></div>
                    <div id="countdown" class="text-sm text-gray-600"></div>
                    <div id="roundStatusIndicator" class="mt-3 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium">
                        <!-- Status will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- LMS Game Interface -->
            <div id="lmsInterface" class="bg-white rounded-xl card-shadow p-6 mb-6">
                <div class="flex flex-wrap gap-2 md:space-x-1 mb-6">
                    <button id="currentRoundTab" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium">Current Round</button>
                    <button id="fixturesTab" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium">All Fixtures</button>
                </div>

                <!-- Current Round Section -->
                <div id="currentRoundSection">
                        <div id="currentRoundHeader" class="mb-4">
                        <div id="currentRoundCountdown" class="text-sm text-gray-600 mb-2"></div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Round <span id="currentRoundHeadingNum">1</span></h3>
                        <p class="text-gray-600">Pick your team to win this round. Remember - you can only use each team once!</p>
                    </div>
                    
                    <div id="currentRoundFixtures" class="space-y-4 mb-6">
                        <div class="mb-3">
                            <h5 class="font-medium text-gray-700 mb-2">Friday 26th September</h5>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                                    <span>Stormers vs Leinster</span>
                                    <span class="text-sm text-gray-500">18:00</span>
                                </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                                    <span>Glasgow Warriors vs Sharks</span>
                                    <span class="text-sm text-gray-500">20:05</span>
                                </div>
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                                    <span>Ulster vs Dragons</span>
                                    <span class="text-sm text-gray-500">20:05</span>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <h5 class="font-medium text-gray-700 mb-2">Saturday 27th September</h5>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                                    <span>Bulls vs Ospreys</span>
                                    <span class="text-sm text-gray-500">13:00</span>
                                </div>
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                                    <span>Zebre vs Edinburgh</span>
                                    <span class="text-sm text-gray-500">15:05</span>
                                </div>
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                                    <span>Scarlets vs Munster</span>
                                    <span class="text-sm text-gray-500">17:30</span>
                                </div>
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                                    <span>Cardiff Rugby vs Lions</span>
                                    <span class="text-sm text-gray-500">19:45</span>
                                </div>
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                                    <span>Connacht vs Benetton Rugby</span>
                                    <span class="text-sm text-gray-500">19:45</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4 class="font-medium text-gray-800 mb-3">Select Your Team to Win:</h4>
                    <p class="text-sm text-gray-600 mb-4">Teams you've used before are marked with ‚úó</p>
                <div id="teamButtons" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 mb-4">
                        <!-- Team buttons will be generated dynamically -->
                    </div>
                    
                    <div id="selectedTeam" class="hidden mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-blue-800">Selected: <span id="selectedTeamName" class="font-semibold"></span></p>
                    </div>
                    
                    <button id="confirmPick" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>Confirm Pick</button>
                </div>

                <!-- All Fixtures Section -->
                <div id="allFixturesSection" class="hidden">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">All URC Fixtures</h3>
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-600">Round:</label>
                            <select id="roundSelector" class="border border-gray-300 rounded px-3 py-1 text-sm">
                                <option value="all">All Rounds</option>
                                <option value="1">Round 1</option>
                                <option value="2">Round 2</option>
                                <option value="3">Round 3</option>
                                <option value="4">Round 4</option>
                                <option value="5">Round 5</option>
                                <option value="6">Round 6</option>
                                <option value="7">Round 7</option>
                                <option value="8">Round 8</option>
                                <option value="9">Round 9</option>
                                <option value="10">Round 10</option>
                                <option value="11">Round 11</option>
                                <option value="12">Round 12</option>
                                <option value="13">Round 13</option>
                                <option value="14">Round 14</option>
                                <option value="15">Round 15</option>
                                <option value="16">Round 16</option>
                                <option value="17">Semi Finals</option>
                                <option value="18">Final</option>
                            </select>
                        </div>
                    </div>
                    <div id="allFixturesCountdown" class="mb-2 text-sm text-gray-600"></div>
                    <div id="allFixturesContent">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
            </div>

            

            

            
        </div>

        <!-- Modals -->
        <div id="picksModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl max-w-2xl w-full max-h-96 overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-800">Round <span id="modalRoundNumber"></span> Picks</h3>
                            <button id="closePicksModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        <div id="picksContent" class="space-y-2">
                            <!-- Picks will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="syncModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl max-w-md w-full">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-800">Remote Sync</h3>
                            <button id="closeSyncModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">Sync URL (GET/PUT JSON)</label>
                            <input type="url" id="syncUrlInput" placeholder="https://example.com/urc.json" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value="">
                            <p class="text-xs text-gray-500 mt-2">Optional: when set, data will sync across devices every 10s.</p>
                            <div class="mt-4 flex space-x-2">
                                <button id="saveSyncUrl" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 font-medium">Save</button>
                                <button id="clearSyncUrl" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 font-medium">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="playerListModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl max-w-md w-full max-h-96 overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-800" id="playerListTitle">Players</h3>
                            <button id="closePlayerListModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        <div id="playerListContent" class="space-y-2">
                            <!-- Player names will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-gray-800">Player Profile</h3>
                            <button id="closeProfileModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        <div id="profileContent">
                            <!-- Profile content will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl max-w-md w-full">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-gray-800">Profile Settings</h3>
                            <button id="closeSettingsModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        <form id="settingsForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Display Name</label>
                                <input type="text" id="settingsDisplayName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Profile Picture</label>
                                
                                <div class="mb-4 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 transition-colors">
                                    <div class="text-center">
                                        <div class="mb-2">
                                            <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                        </div>
                                        <label for="settingsCustomProfilePic" class="cursor-pointer">
                                            <span class="text-sm text-blue-600 hover:text-blue-500 font-medium">Upload your picture</span>
                                            <input id="settingsCustomProfilePic" type="file" accept="image/*" class="hidden">
                                        </label>
                                        <p class="text-xs text-gray-500 mt-1">JPG, PNG, GIF up to 2MB</p>
                                    </div>
                                    <div id="settingsCustomPicPreview" class="hidden mt-3 text-center">
                                        <img id="settingsCustomPicImage" class="w-16 h-16 rounded-full mx-auto object-cover border-2 border-blue-500" alt="Custom profile picture">
                                        <button type="button" id="settingsRemoveCustomPic" class="mt-2 text-xs text-red-600 hover:text-red-800">Remove</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Favorite URC Team</label>
                                <select id="settingsFavoriteTeam" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select your favorite team</option>
                                    <option value="Benetton Rugby">Benetton Rugby</option>
                                    <option value="Bulls">Bulls</option>
                                    <option value="Cardiff Rugby">Cardiff Rugby</option>
                                    <option value="Connacht">Connacht</option>
                                    <option value="Dragons">Dragons</option>
                                    <option value="Edinburgh">Edinburgh</option>
                                    <option value="Glasgow Warriors">Glasgow Warriors</option>
                                    <option value="Leinster">Leinster</option>
                                    <option value="Lions">Lions</option>
                                    <option value="Munster">Munster</option>
                                    <option value="Ospreys">Ospreys</option>
                                    <option value="Scarlets">Scarlets</option>
                                    <option value="Sharks">Sharks</option>
                                    <option value="Stormers">Stormers</option>
                                    <option value="Ulster">Ulster</option>
                                    <option value="Zebre">Zebre</option>
                                </select>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button type="submit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 font-medium">Save Changes</button>
                                <button type="button" id="cancelSettings" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 font-medium">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-800">üîß Admin Management Panel</h3>
                            <button id="closeAdminModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        
                        <div class="flex space-x-1 mb-6">
                            <button id="adminScoresTab" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium">Match Results</button>
                            <button id="adminPlayersTab" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium">Player Management</button>
                            <button id="adminPlayoffsTab" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium">Playoffs</button>
                        </div>
                        
                        <div id="adminScoresSection">
                            <div class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <p class="text-sm text-yellow-800">‚ö†Ô∏è Admin only: Manually set match results. Players are only eliminated when matches are marked as FINISHED.</p>
                            </div>
                            <div class="mb-4 flex justify-between items-center">
                                <h4 class="font-semibold text-gray-800">Match Results Management</h4>
                                <div class="flex items-center space-x-2">
                                    <label class="text-sm text-gray-600">Round:</label>
                                    <select id="adminRoundSelector" class="border border-gray-300 rounded px-3 py-1 text-sm">
                                        <option value="1">Round 1</option>
                                        <option value="2">Round 2</option>
                                        <option value="3">Round 3</option>
                                        <option value="4">Round 4</option>
                                        <option value="5">Round 5</option>
                                        <option value="6">Round 6</option>
                                        <option value="7">Round 7</option>
                                        <option value="8">Round 8</option>
                                        <option value="9">Round 9</option>
                                        <option value="10">Round 10</option>
                                        <option value="11">Round 11</option>
                                        <option value="12">Round 12</option>
                                        <option value="13">Round 13</option>
                                        <option value="14">Round 14</option>
                                        <option value="15">Round 15</option>
                                        <option value="16">Round 16</option>
                                        <option value="17">Semi Finals</option>
                                        <option value="18">Final</option>
                                    </select>
                                </div>
                            </div>
                            <div id="adminScoreContent" class="space-y-4">
                                <!-- Admin score forms will be populated here -->
                            </div>
                        </div>
                        
                        <div id="adminPlayersSection" class="hidden">
                            <div class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                                <p class="text-sm text-red-800">‚ö†Ô∏è Danger Zone: Manually override player status and picks. Use only when system fails.</p>
                            </div>
                            <div id="adminPlayerContent" class="space-y-4">
                                <!-- Admin player forms will be populated here -->
                            </div>
                        </div>
                        
                        <div id="adminPlayoffsSection" class="hidden">
                            <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                <p class="text-sm text-blue-800">üèÜ Playoff Management: Set teams and times for Semi Finals and Final matches.</p>
                            </div>
                            
                            <!-- Semi Finals Setup -->
                            <div class="bg-white border rounded-lg p-4 mb-4">
                                <h4 class="font-semibold text-gray-800 mb-4">ü•Ö Semi Finals - Friday 6th June</h4>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="border rounded p-3">
                                        <h5 class="font-medium text-gray-700 mb-2">Semi Final 1</h5>
                                        <div class="space-y-2">
                                            <div class="flex space-x-2">
                                                <select id="sf1Home" class="flex-1 text-sm border border-gray-300 rounded px-2 py-1">
                                                    <option value="TBD">TBD</option>
                                                    <option value="Benetton Rugby">Benetton Rugby</option>
                                                    <option value="Bulls">Bulls</option>
                                                    <option value="Cardiff Rugby">Cardiff Rugby</option>
                                                    <option value="Connacht">Connacht</option>
                                                    <option value="Dragons">Dragons</option>
                                                    <option value="Edinburgh">Edinburgh</option>
                                                    <option value="Glasgow Warriors">Glasgow Warriors</option>
                                                    <option value="Leinster">Leinster</option>
                                                    <option value="Lions">Lions</option>
                                                    <option value="Munster">Munster</option>
                                                    <option value="Ospreys">Ospreys</option>
                                                    <option value="Scarlets">Scarlets</option>
                                                    <option value="Sharks">Sharks</option>
                                                    <option value="Stormers">Stormers</option>
                                                    <option value="Ulster">Ulster</option>
                                                    <option value="Zebre">Zebre</option>
                                                </select>
                                                <span class="text-gray-500 py-1">vs</span>
                                                <select id="sf1Away" class="flex-1 text-sm border border-gray-300 rounded px-2 py-1">
                                                    <option value="TBD">TBD</option>
                                                    <option value="Benetton Rugby">Benetton Rugby</option>
                                                    <option value="Bulls">Bulls</option>
                                                    <option value="Cardiff Rugby">Cardiff Rugby</option>
                                                    <option value="Connacht">Connacht</option>
                                                    <option value="Dragons">Dragons</option>
                                                    <option value="Edinburgh">Edinburgh</option>
                                                    <option value="Glasgow Warriors">Glasgow Warriors</option>
                                                    <option value="Leinster">Leinster</option>
                                                    <option value="Lions">Lions</option>
                                                    <option value="Munster">Munster</option>
                                                    <option value="Ospreys">Ospreys</option>
                                                    <option value="Scarlets">Scarlets</option>
                                                    <option value="Sharks">Sharks</option>
                                                    <option value="Stormers">Stormers</option>
                                                    <option value="Ulster">Ulster</option>
                                                    <option value="Zebre">Zebre</option>
                                                </select>
                                            </div>
                                            <input type="time" id="sf1Time" class="w-full text-sm border border-gray-300 rounded px-2 py-1" placeholder="Kick-off time">
                                        </div>
                                    </div>
                                    
                                    <div class="border rounded p-3">
                                        <h5 class="font-medium text-gray-700 mb-2">Semi Final 2</h5>
                                        <div class="space-y-2">
                                            <div class="flex space-x-2">
                                                <select id="sf2Home" class="flex-1 text-sm border border-gray-300 rounded px-2 py-1">
                                                    <option value="TBD">TBD</option>
                                                    <option value="Benetton Rugby">Benetton Rugby</option>
                                                    <option value="Bulls">Bulls</option>
                                                    <option value="Cardiff Rugby">Cardiff Rugby</option>
                                                    <option value="Connacht">Connacht</option>
                                                    <option value="Dragons">Dragons</option>
                                                    <option value="Edinburgh">Edinburgh</option>
                                                    <option value="Glasgow Warriors">Glasgow Warriors</option>
                                                    <option value="Leinster">Leinster</option>
                                                    <option value="Lions">Lions</option>
                                                    <option value="Munster">Munster</option>
                                                    <option value="Ospreys">Ospreys</option>
                                                    <option value="Scarlets">Scarlets</option>
                                                    <option value="Sharks">Sharks</option>
                                                    <option value="Stormers">Stormers</option>
                                                    <option value="Ulster">Ulster</option>
                                                    <option value="Zebre">Zebre</option>
                                                </select>
                                                <span class="text-gray-500 py-1">vs</span>
                                                <select id="sf2Away" class="flex-1 text-sm border border-gray-300 rounded px-2 py-1">
                                                    <option value="TBD">TBD</option>
                                                    <option value="Benetton Rugby">Benetton Rugby</option>
                                                    <option value="Bulls">Bulls</option>
                                                    <option value="Cardiff Rugby">Cardiff Rugby</option>
                                                    <option value="Connacht">Connacht</option>
                                                    <option value="Dragons">Dragons</option>
                                                    <option value="Edinburgh">Edinburgh</option>
                                                    <option value="Glasgow Warriors">Glasgow Warriors</option>
                                                    <option value="Leinster">Leinster</option>
                                                    <option value="Lions">Lions</option>
                                                    <option value="Munster">Munster</option>
                                                    <option value="Ospreys">Ospreys</option>
                                                    <option value="Scarlets">Scarlets</option>
                                                    <option value="Sharks">Sharks</option>
                                                    <option value="Stormers">Stormers</option>
                                                    <option value="Ulster">Ulster</option>
                                                    <option value="Zebre">Zebre</option>
                                                </select>
                                            </div>
                                            <input type="time" id="sf2Time" class="w-full text-sm border border-gray-300 rounded px-2 py-1" placeholder="Kick-off time">
                                        </div>
                                    </div>
                                </div>
                                
                                <button onclick="updateSemiFinals()" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Update Semi Finals</button>
                            </div>
                            
                            <!-- Final Setup -->
                            <div class="bg-white border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-4">üèÜ Final - Friday 20th June</h4>
                                
                                <div class="border rounded p-3">
                                    <div class="space-y-2">
                                        <div class="flex space-x-2">
                                            <select id="finalHome" class="flex-1 text-sm border border-gray-300 rounded px-2 py-1">
                                                <option value="TBD">TBD</option>
                                                <option value="Benetton Rugby">Benetton Rugby</option>
                                                <option value="Bulls">Bulls</option>
                                                <option value="Cardiff Rugby">Cardiff Rugby</option>
                                                <option value="Connacht">Connacht</option>
                                                <option value="Dragons">Dragons</option>
                                                <option value="Edinburgh">Edinburgh</option>
                                                <option value="Glasgow Warriors">Glasgow Warriors</option>
                                                <option value="Leinster">Leinster</option>
                                                <option value="Lions">Lions</option>
                                                <option value="Munster">Munster</option>
                                                <option value="Ospreys">Ospreys</option>
                                                <option value="Scarlets">Scarlets</option>
                                                <option value="Sharks">Sharks</option>
                                                <option value="Stormers">Stormers</option>
                                                <option value="Ulster">Ulster</option>
                                                <option value="Zebre">Zebre</option>
                                            </select>
                                            <span class="text-gray-500 py-1">vs</span>
                                            <select id="finalAway" class="flex-1 text-sm border border-gray-300 rounded px-2 py-1">
                                                <option value="TBD">TBD</option>
                                                <option value="Benetton Rugby">Benetton Rugby</option>
                                                <option value="Bulls">Bulls</option>
                                                <option value="Cardiff Rugby">Cardiff Rugby</option>
                                                <option value="Connacht">Connacht</option>
                                                <option value="Dragons">Dragons</option>
                                                <option value="Edinburgh">Edinburgh</option>
                                                <option value="Glasgow Warriors">Glasgow Warriors</option>
                                                <option value="Leinster">Leinster</option>
                                                <option value="Lions">Lions</option>
                                                <option value="Munster">Munster</option>
                                                <option value="Ospreys">Ospreys</option>
                                                <option value="Scarlets">Scarlets</option>
                                                <option value="Sharks">Sharks</option>
                                                <option value="Stormers">Stormers</option>
                                                <option value="Ulster">Ulster</option>
                                                <option value="Zebre">Zebre</option>
                                            </select>
                                        </div>
                                        <input type="time" id="finalTime" class="w-full text-sm border border-gray-300 rounded px-2 py-1" placeholder="Kick-off time">
                                    </div>
                                </div>
                                
                                <button onclick="updateFinal()" class="mt-3 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">Update Final</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let currentUser = null;
        let currentGameMode = 'lms'; // 'lms' or 'pickit' - LMS is default
        let gameData = {
            players: [],
            currentRound: 1,
            roundDeadline: new Date('2025-09-26T17:30:00'),
            roundEnd: new Date('2025-09-27T21:30:00'),
            pickingOpen: true,
            matchResults: {},
            chatMessages: [],
            updatedAt: Date.now()
        };

        // Chat state
        let lastReadMessageId = null;
        let unreadCount = 0;

        // Email normalization
        function normalizeEmail(email) {
            return (email || '').trim().toLowerCase();
        }

        function refreshHeaderUserBadge() {
            const nameEl = document.getElementById('userName');
            if (nameEl && currentUser) {
                nameEl.textContent = currentUser.displayName;
            }
            const userProfilePicElement = document.getElementById('userProfilePic');
            if (userProfilePicElement && currentUser) {
                if (currentUser.isCustomPic && currentUser.profilePic && currentUser.profilePic.startsWith('data:')) {
                    userProfilePicElement.innerHTML = `<img src="${currentUser.profilePic}" class="w-8 h-8 rounded-full object-cover border border-gray-300" alt="Profile">`;
                } else {
                    userProfilePicElement.innerHTML = `<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRgMFCSXJWsbmkra95ltt9Z9LJiRuMOsIBluqwF-g4&usqp=CAE&s" class="w-8 h-8 rounded-full object-cover border border-gray-300" alt="Profile" onerror="this.src=''; this.style.display='none'; this.nextElementSibling.style.display='block';"><div class="w-8 h-8 rounded-full bg-gray-300 border border-gray-400" style="display: none;"></div>`;
                }
            }
        }

        // Optional remote sync
        let syncUrl = localStorage.getItem('urcSyncUrl') || null;

        async function syncPullAndMaybeUpdate() {
            if (!syncUrl) return;
            try {
                const res = await fetch(syncUrl, { cache: 'no-store' });
                if (!res.ok) return;
                const remote = await res.json();
                if (!remote || typeof remote !== 'object') return;
                if (!remote.updatedAt || remote.updatedAt > (gameData.updatedAt || 0)) {
                    gameData = { ...gameData, ...remote };
                    localStorage.setItem('urcGameData', JSON.stringify(gameData));
                    // Rebind currentUser by email if present
                    const savedEmail = localStorage.getItem('currentUserEmail');
                    if (savedEmail) {
                        const player = gameData.players.find(p => normalizeEmail(p.email) === normalizeEmail(savedEmail));
                        if (player) currentUser = player;
                    }
                    updateUI();
                    refreshHeaderUserBadge();
                }
            } catch (e) {
                // silent
            }
        }

        let syncPushTimer = null;
        function scheduleSyncPush() {
            if (!syncUrl) return;
            if (syncPushTimer) clearTimeout(syncPushTimer);
            syncPushTimer = setTimeout(async () => {
                try {
                    await fetch(syncUrl, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(gameData)
                    });
                } catch (e) {
                    // silent
                }
            }, 500);
        }

        function setSyncUrl(url) {
            syncUrl = (url || '').trim() || null;
            if (syncUrl) localStorage.setItem('urcSyncUrl', syncUrl); else localStorage.removeItem('urcSyncUrl');
        }

        // Timezone helpers (UK time handling and formatting)
        function pad2(num) { return String(num).padStart(2, '0'); }

        function getLastSundayDayOfMonth(year, monthIndex /* 0-11 */) {
            const d = new Date(Date.UTC(year, monthIndex + 1, 0));
            while (d.getUTCDay() !== 0) {
                d.setUTCDate(d.getUTCDate() - 1);
            }
            return d.getUTCDate();
        }

        function isDateInBST(year, monthIndex, dayOfMonth) {
            // BST starts last Sunday in March, ends last Sunday in October
            const marchLastSunday = getLastSundayDayOfMonth(year, 2);   // March
            const octoberLastSunday = getLastSundayDayOfMonth(year, 9); // October
            const afterStart = (monthIndex > 2) || (monthIndex === 2 && dayOfMonth >= marchLastSunday);
            const beforeEnd = (monthIndex < 9) || (monthIndex === 9 && dayOfMonth < octoberLastSunday);
            return afterStart && beforeEnd;
        }

        function getLondonOffsetString(year, monthIndex, dayOfMonth) {
            return isDateInBST(year, monthIndex, dayOfMonth) ? '+01:00' : '+00:00';
        }

        function makeLondonDate(year, monthIndex /* 0-11 */, dayOfMonth, hour24, minute) {
            const y = year;
            const m = pad2(monthIndex + 1);
            const d = pad2(dayOfMonth);
            const hh = pad2(hour24);
            const mm = pad2(minute);
            const offset = getLondonOffsetString(year, monthIndex, dayOfMonth);
            // Construct an absolute instant representing this London local time
            return new Date(`${y}-${m}-${d}T${hh}:${mm}:00${offset}`);
        }

        const MONTH_NAME_TO_INDEX = {
            'January': 0, 'February': 1, 'March': 2, 'April': 3, 'May': 4, 'June': 5,
            'July': 6, 'August': 7, 'September': 8, 'October': 9, 'November': 10, 'December': 11
        };

        function parseMatchLondonDate(dayLabel, timeLabel, fallbackYear) {
            // dayLabel e.g. "Friday 26th September"; timeLabel e.g. "18:00"
            const dayNum = parseInt((dayLabel.match(/\d+/) || [])[0], 10);
            const monthName = (dayLabel.trim().split(' ').pop()) || 'September';
            const monthIndex = MONTH_NAME_TO_INDEX[monthName] ?? 8;
            const [hh, mm] = timeLabel.split(':').map(v => parseInt(v, 10));
            return makeLondonDate(fallbackYear, monthIndex, dayNum, hh, mm);
        }

        function formatInTimeZones(date) {
            const userTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const fmtOpts = { weekday: 'short', day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' };
            const uk = new Intl.DateTimeFormat('en-GB', { ...fmtOpts, timeZone: 'Europe/London', hour12: false }).format(date);
            const local = new Intl.DateTimeFormat(undefined, { ...fmtOpts, timeZone: userTz, hour12: false }).format(date);
            return { uk, local };
        }

        function formatCountdown(ms) {
            if (ms <= 0) return '0m 00s';
            const totalSeconds = Math.floor(ms / 1000);
            const days = Math.floor(totalSeconds / 86400);
            const hours = Math.floor((totalSeconds % 86400) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            if (days > 0) return `${days}d ${hours}h ${minutes}m`;
            if (hours > 0) return `${hours}h ${minutes}m ${pad2(seconds)}s`;
            return `${minutes}m ${pad2(seconds)}s`;
        }

        // Deadline management
        function calculatePickingStatus() {
            const now = new Date();
            const roundData = roundFixtures[gameData.currentRound];
            
            if (!roundData || !roundData.matches || roundData.matches.length === 0) {
                return { isOpen: false, message: 'No fixtures available', deadline: null };
            }
            
            // Find the earliest match in the round using UK time, then convert to absolute instant
            let earliestTime = null;
            const baseYear = (gameData.roundDeadline ? new Date(gameData.roundDeadline).getFullYear() : new Date().getFullYear());
            roundData.matches.forEach(match => {
                const matchDateLondon = parseMatchLondonDate(match.day, match.time, baseYear);
                if (!earliestTime || matchDateLondon < earliestTime) {
                    earliestTime = matchDateLondon;
                }
            });
            
            if (!earliestTime) {
                return { isOpen: false, message: 'No valid match times', deadline: null };
            }
            
            // Deadline is 30 minutes before the earliest match
            const deadline = new Date(earliestTime.getTime() - (30 * 60 * 1000));
            
            // Round opens on Monday at midnight (start of the week)
            const roundStartDate = new Date(deadline);
            roundStartDate.setDate(roundStartDate.getDate() - 4); // Go back to Monday
            roundStartDate.setHours(0, 0, 0, 0);
            
            const isOpen = now >= roundStartDate && now < deadline;
            
            let message = '';
            let timeUntil = '';
            
            if (now < roundStartDate) {
                const timeToOpen = roundStartDate.getTime() - now.getTime();
                const days = Math.floor(timeToOpen / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeToOpen % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                message = `üîí Picking opens in ${days}d ${hours}h`;
            } else if (isOpen) {
                const timeToClose = deadline.getTime() - now.getTime();
                message = `üü¢ Picking is OPEN`;
                timeUntil = `Closes in ${formatCountdown(timeToClose)}`;
            } else {
                if (now < earliestTime) {
                    message = `üîí Picking is LOCKED`;
                    timeUntil = `Round starts in ${formatCountdown(earliestTime.getTime() - now.getTime())}`;
                } else {
                    message = `üü° Round Started`;
                    timeUntil = '';
                }
            }
            
            return {
                isOpen: isOpen,
                message: message,
                timeUntil: timeUntil,
                deadline: deadline,
                roundStart: roundStartDate,
                earliestKickoff: earliestTime
            };
        }

        // Email verification state
        let verificationState = {
            email: null,
            code: null,
            expiresAt: null,
            attempts: 0,
            maxAttempts: 3,
            timer: null
        };

        // Registration state
        let registrationData = {
            email: '',
            displayName: '',
            profilePic: null,
            isCustomPic: false,
            favoriteTeam: ''
        };

        // Helper function to check if match is live
        function isMatchLive(match) {
            const now = new Date();
            const kickoffTime = new Date(`2025-09-${match.day.includes('26th') ? '26' : '27'} ${match.time}`);
            const endTime = new Date(kickoffTime.getTime() + (120 * 60 * 1000)); // 120 minutes after kickoff
            return now >= kickoffTime && now <= endTime;
        }

        // Round fixtures
        const roundFixtures = {
            1: {
                teams: ['Stormers', 'Leinster', 'Glasgow Warriors', 'Sharks', 'Ulster', 'Dragons', 'Bulls', 'Ospreys', 'Zebre', 'Edinburgh', 'Scarlets', 'Munster', 'Cardiff Rugby', 'Lions', 'Connacht', 'Benetton Rugby'],
                matches: [
                    { id: 'r1g1', home: 'Stormers', away: 'Leinster', time: '18:00', day: 'Friday 26th September' },
                    { id: 'r1g2', home: 'Glasgow Warriors', away: 'Sharks', time: '20:05', day: 'Friday 26th September' },
                    { id: 'r1g3', home: 'Ulster', away: 'Dragons', time: '20:05', day: 'Friday 26th September' },
                    { id: 'r1g4', home: 'Bulls', away: 'Ospreys', time: '13:00', day: 'Saturday 27th September' },
                    { id: 'r1g5', home: 'Zebre', away: 'Edinburgh', time: '15:05', day: 'Saturday 27th September' },
                    { id: 'r1g6', home: 'Scarlets', away: 'Munster', time: '17:30', day: 'Saturday 27th September' },
                    { id: 'r1g7', home: 'Cardiff Rugby', away: 'Lions', time: '19:45', day: 'Saturday 27th September' },
                    { id: 'r1g8', home: 'Connacht', away: 'Benetton Rugby', time: '19:45', day: 'Saturday 27th September' }
                ]
            },
            2: {
                teams: ['Stormers', 'Ospreys', 'Dragons', 'Sharks', 'Edinburgh', 'Ulster', 'Connacht', 'Scarlets', 'Benetton Rugby', 'Glasgow Warriors', 'Bulls', 'Leinster', 'Munster', 'Cardiff Rugby', 'Zebre', 'Lions'],
                matches: [
                    { id: 'r2g1', home: 'Stormers', away: 'Ospreys', time: '18:00', day: 'Friday 3rd October' },
                    { id: 'r2g2', home: 'Dragons', away: 'Sharks', time: '20:05', day: 'Friday 3rd October' },
                    { id: 'r2g3', home: 'Edinburgh', away: 'Ulster', time: '20:05', day: 'Friday 3rd October' },
                    { id: 'r2g4', home: 'Connacht', away: 'Scarlets', time: '13:45', day: 'Saturday 4th October' },
                    { id: 'r2g5', home: 'Benetton Rugby', away: 'Glasgow Warriors', time: '17:30', day: 'Saturday 4th October' },
                    { id: 'r2g6', home: 'Bulls', away: 'Leinster', time: '17:30', day: 'Saturday 4th October' },
                    { id: 'r2g7', home: 'Munster', away: 'Cardiff Rugby', time: '19:45', day: 'Saturday 4th October' },
                    { id: 'r2g8', home: 'Zebre', away: 'Lions', time: '15:00', day: 'Sunday 5th October' }
                ]
            },
            3: {
                teams: ['Munster', 'Edinburgh', 'Scarlets', 'Stormers', 'Benetton Rugby', 'Lions', 'Ospreys', 'Zebre', 'Glasgow Warriors', 'Dragons', 'Leinster', 'Sharks', 'Cardiff Rugby', 'Connacht', 'Ulster', 'Bulls'],
                matches: [
                    { id: 'r3g1', home: 'Munster', away: 'Edinburgh', time: '19:45', day: 'Friday 10th October' },
                    { id: 'r3g2', home: 'Scarlets', away: 'Stormers', time: '19:45', day: 'Friday 10th October' },
                    { id: 'r3g3', home: 'Benetton Rugby', away: 'Lions', time: '15:00', day: 'Saturday 11th October' },
                    { id: 'r3g4', home: 'Ospreys', away: 'Zebre', time: '15:00', day: 'Saturday 11th October' },
                    { id: 'r3g5', home: 'Glasgow Warriors', away: 'Dragons', time: '17:30', day: 'Saturday 11th October' },
                    { id: 'r3g6', home: 'Leinster', away: 'Sharks', time: '17:30', day: 'Saturday 11th October' },
                    { id: 'r3g7', home: 'Cardiff Rugby', away: 'Connacht', time: '19:45', day: 'Saturday 11th October' },
                    { id: 'r3g8', home: 'Ulster', away: 'Bulls', time: '19:45', day: 'Saturday 11th October' }
                ]
            },
            4: {
                teams: ['Connacht', 'Bulls', 'Dragons', 'Cardiff Rugby', 'Edinburgh', 'Benetton Rugby', 'Lions', 'Scarlets', 'Sharks', 'Ulster', 'Leinster', 'Munster', 'Ospreys', 'Glasgow Warriors', 'Zebre', 'Stormers'],
                matches: [
                    { id: 'r4g1', home: 'Connacht', away: 'Bulls', time: '19:45', day: 'Friday 17th October' },
                    { id: 'r4g2', home: 'Dragons', away: 'Cardiff Rugby', time: '19:45', day: 'Friday 17th October' },
                    { id: 'r4g3', home: 'Edinburgh', away: 'Benetton Rugby', time: '19:45', day: 'Friday 17th October' },
                    { id: 'r4g4', home: 'Lions', away: 'Scarlets', time: '12:45', day: 'Saturday 18th October' },
                    { id: 'r4g5', home: 'Sharks', away: 'Ulster', time: '15:00', day: 'Saturday 18th October' },
                    { id: 'r4g6', home: 'Leinster', away: 'Munster', time: '17:15', day: 'Saturday 18th October' },
                    { id: 'r4g7', home: 'Ospreys', away: 'Glasgow Warriors', time: '19:45', day: 'Saturday 18th October' },
                    { id: 'r4g8', home: 'Zebre', away: 'Stormers', time: '19:45', day: 'Saturday 18th October' }
                ]
            },
            5: {
                teams: ['Glasgow Warriors', 'Bulls', 'Lions', 'Ulster', 'Sharks', 'Scarlets', 'Benetton Rugby', 'Stormers', 'Dragons', 'Ospreys', 'Leinster', 'Zebre', 'Cardiff Rugby', 'Edinburgh', 'Munster', 'Connacht'],
                matches: [
                    { id: 'r5g1', home: 'Glasgow Warriors', away: 'Bulls', time: '19:45', day: 'Friday 24th October' },
                    { id: 'r5g2', home: 'Lions', away: 'Ulster', time: '12:45', day: 'Saturday 25th October' },
                    { id: 'r5g3', home: 'Sharks', away: 'Scarlets', time: '15:00', day: 'Saturday 25th October' },
                    { id: 'r5g4', home: 'Benetton Rugby', away: 'Stormers', time: '17:30', day: 'Saturday 25th October' },
                    { id: 'r5g5', home: 'Dragons', away: 'Ospreys', time: '17:30', day: 'Saturday 25th October' },
                    { id: 'r5g6', home: 'Leinster', away: 'Zebre', time: '17:30', day: 'Saturday 25th October' },
                    { id: 'r5g7', home: 'Cardiff Rugby', away: 'Edinburgh', time: '19:45', day: 'Saturday 25th October' },
                    { id: 'r5g8', home: 'Munster', away: 'Connacht', time: '19:45', day: 'Saturday 25th October' }
                ]
            },
            6: {
                teams: ['Dragons', 'Leinster', 'Ulster', 'Benetton Rugby', 'Bulls', 'Lions', 'Zebre', 'Cardiff Rugby', 'Edinburgh', 'Ospreys', 'Munster', 'Stormers', 'Connacht', 'Sharks', 'Scarlets', 'Glasgow Warriors'],
                matches: [
                    { id: 'r6g1', home: 'Dragons', away: 'Leinster', time: '19:45', day: 'Friday 28th November' },
                    { id: 'r6g2', home: 'Ulster', away: 'Benetton Rugby', time: '19:45', day: 'Friday 28th November' },
                    { id: 'r6g3', home: 'Bulls', away: 'Lions', time: '12:00', day: 'Saturday 29th November' },
                    { id: 'r6g4', home: 'Zebre', away: 'Cardiff Rugby', time: '13:00', day: 'Saturday 29th November' },
                    { id: 'r6g5', home: 'Edinburgh', away: 'Ospreys', time: '17:30', day: 'Saturday 29th November' },
                    { id: 'r6g6', home: 'Munster', away: 'Stormers', time: '17:30', day: 'Saturday 29th November' },
                    { id: 'r6g7', home: 'Connacht', away: 'Sharks', time: '19:45', day: 'Saturday 29th November' },
                    { id: 'r6g8', home: 'Scarlets', away: 'Glasgow Warriors', time: '19:45', day: 'Saturday 29th November' }
                ]
            },
            7: {
                teams: ['Cardiff Rugby', 'Scarlets', 'Leinster', 'Ulster', 'Stormers', 'Lions', 'Benetton Rugby', 'Zebre', 'Glasgow Warriors', 'Edinburgh', 'Sharks', 'Bulls', 'Ospreys', 'Munster', 'Dragons', 'Connacht'],
                matches: [
                    { id: 'r7g1', home: 'Cardiff Rugby', away: 'Scarlets', time: '19:45', day: 'Friday 19th December' },
                    { id: 'r7g2', home: 'Leinster', away: 'Ulster', time: '19:45', day: 'Friday 19th December' },
                    { id: 'r7g3', home: 'Stormers', away: 'Lions', time: '13:30', day: 'Saturday 20th December' },
                    { id: 'r7g4', home: 'Benetton Rugby', away: 'Zebre', time: '14:00', day: 'Saturday 20th December' },
                    { id: 'r7g5', home: 'Glasgow Warriors', away: 'Edinburgh', time: '15:00', day: 'Saturday 20th December' },
                    { id: 'r7g6', home: 'Sharks', away: 'Bulls', time: '16:00', day: 'Saturday 20th December' },
                    { id: 'r7g7', home: 'Ospreys', away: 'Munster', time: '17:30', day: 'Saturday 20th December' },
                    { id: 'r7g8', home: 'Dragons', away: 'Connacht', time: '19:45', day: 'Saturday 20th December' }
                ]
            },
            8: {
                teams: ['Bulls', 'Stormers', 'Lions', 'Sharks', 'Cardiff Rugby', 'Dragons', 'Scarlets', 'Ospreys', 'Zebre', 'Benetton Rugby', 'Edinburgh', 'Glasgow Warriors', 'Connacht', 'Ulster', 'Munster', 'Leinster'],
                matches: [
                    { id: 'r8g1', home: 'Bulls', away: 'Stormers', time: '00:00', day: 'Friday 26th December' },
                    { id: 'r8g2', home: 'Lions', away: 'Sharks', time: '00:00', day: 'Friday 26th December' },
                    { id: 'r8g3', home: 'Cardiff Rugby', away: 'Dragons', time: '15:00', day: 'Friday 26th December' },
                    { id: 'r8g4', home: 'Scarlets', away: 'Ospreys', time: '17:30', day: 'Friday 26th December' },
                    { id: 'r8g5', home: 'Zebre', away: 'Benetton Rugby', time: '14:30', day: 'Saturday 27th December' },
                    { id: 'r8g6', home: 'Edinburgh', away: 'Glasgow Warriors', time: '15:00', day: 'Saturday 27th December' },
                    { id: 'r8g7', home: 'Connacht', away: 'Ulster', time: '17:30', day: 'Saturday 27th December' },
                    { id: 'r8g8', home: 'Munster', away: 'Leinster', time: '19:45', day: 'Saturday 27th December' }
                ]
            },
            9: {
                teams: ['Dragons', 'Scarlets', 'Ospreys', 'Cardiff Rugby', 'Ulster', 'Munster', 'Sharks', 'Lions', 'Stormers', 'Bulls', 'Benetton Rugby', 'Edinburgh', 'Leinster', 'Connacht', 'Glasgow Warriors', 'Zebre'],
                matches: [
                    { id: 'r9g1', home: 'Dragons', away: 'Scarlets', time: '15:00', day: 'Thursday 1st January' },
                    { id: 'r9g2', home: 'Ospreys', away: 'Cardiff Rugby', time: '17:30', day: 'Thursday 1st January' },
                    { id: 'r9g3', home: 'Ulster', away: 'Munster', time: '19:45', day: 'Friday 2nd January' },
                    { id: 'r9g4', home: 'Sharks', away: 'Lions', time: '13:30', day: 'Saturday 3rd January' },
                    { id: 'r9g5', home: 'Stormers', away: 'Bulls', time: '16:00', day: 'Saturday 3rd January' },
                    { id: 'r9g6', home: 'Benetton Rugby', away: 'Edinburgh', time: '17:30', day: 'Saturday 3rd January' },
                    { id: 'r9g7', home: 'Leinster', away: 'Connacht', time: '17:30', day: 'Saturday 3rd January' },
                    { id: 'r9g8', home: 'Glasgow Warriors', away: 'Zebre', time: '19:45', day: 'Saturday 3rd January' }
                ]
            },
            10: {
                teams: ['Edinburgh', 'Bulls', 'Munster', 'Dragons', 'Ospreys', 'Lions', 'Scarlets', 'Ulster', 'Connacht', 'Leinster', 'Stormers', 'Sharks', 'Cardiff Rugby', 'Benetton Rugby', 'Zebre', 'Glasgow Warriors'],
                matches: [
                    { id: 'r10g1', home: 'Edinburgh', away: 'Bulls', time: '19:45', day: 'Friday 23rd January' },
                    { id: 'r10g2', home: 'Munster', away: 'Dragons', time: '19:45', day: 'Friday 23rd January' },
                    { id: 'r10g3', home: 'Ospreys', away: 'Lions', time: '19:45', day: 'Friday 23rd January' },
                    { id: 'r10g4', home: 'Scarlets', away: 'Ulster', time: '15:00', day: 'Saturday 24th January' },
                    { id: 'r10g5', home: 'Connacht', away: 'Leinster', time: '17:30', day: 'Saturday 24th January' },
                    { id: 'r10g6', home: 'Stormers', away: 'Sharks', time: '17:30', day: 'Saturday 24th January' },
                    { id: 'r10g7', home: 'Cardiff Rugby', away: 'Benetton Rugby', time: '19:45', day: 'Saturday 24th January' },
                    { id: 'r10g8', home: 'Zebre', away: 'Glasgow Warriors', time: '19:45', day: 'Saturday 24th January' }
                ]
            },
            11: {
                teams: ['Benetton Rugby', 'Scarlets', 'Glasgow Warriors', 'Munster', 'Lions', 'Bulls', 'Sharks', 'Stormers', 'Zebre', 'Connacht', 'Leinster', 'Edinburgh', 'Ospreys', 'Dragons', 'Ulster', 'Cardiff Rugby'],
                matches: [
                    { id: 'r11g1', home: 'Benetton Rugby', away: 'Scarlets', time: '19:45', day: 'Friday 30th January' },
                    { id: 'r11g2', home: 'Glasgow Warriors', away: 'Munster', time: '19:45', day: 'Friday 30th January' },
                    { id: 'r11g3', home: 'Lions', away: 'Bulls', time: '12:30', day: 'Saturday 31st January' },
                    { id: 'r11g4', home: 'Sharks', away: 'Stormers', time: '15:00', day: 'Saturday 31st January' },
                    { id: 'r11g5', home: 'Zebre', away: 'Connacht', time: '15:00', day: 'Saturday 31st January' },
                    { id: 'r11g6', home: 'Leinster', away: 'Edinburgh', time: '17:30', day: 'Saturday 31st January' },
                    { id: 'r11g7', home: 'Ospreys', away: 'Dragons', time: '19:45', day: 'Saturday 31st January' },
                    { id: 'r11g8', home: 'Ulster', away: 'Cardiff Rugby', time: '19:45', day: 'Saturday 31st January' }
                ]
            },
            12: {
                teams: ['Cardiff Rugby', 'Leinster', 'Edinburgh', 'Scarlets', 'Lions', 'Stormers', 'Bulls', 'Sharks', 'Connacht', 'Glasgow Warriors', 'Dragons', 'Benetton Rugby', 'Munster', 'Zebre', 'Ospreys', 'Ulster'],
                matches: [
                    { id: 'r12g1', home: 'Cardiff Rugby', away: 'Leinster', time: '19:45', day: 'Friday 27th February' },
                    { id: 'r12g2', home: 'Edinburgh', away: 'Scarlets', time: '19:45', day: 'Friday 27th February' },
                    { id: 'r12g3', home: 'Lions', away: 'Stormers', time: '12:30', day: 'Saturday 28th February' },
                    { id: 'r12g4', home: 'Bulls', away: 'Sharks', time: '15:00', day: 'Saturday 28th February' },
                    { id: 'r12g5', home: 'Connacht', away: 'Glasgow Warriors', time: '15:00', day: 'Saturday 28th February' },
                    { id: 'r12g6', home: 'Dragons', away: 'Benetton Rugby', time: '17:30', day: 'Saturday 28th February' },
                    { id: 'r12g7', home: 'Munster', away: 'Zebre', time: '17:30', day: 'Saturday 28th February' },
                    { id: 'r12g8', home: 'Ospreys', away: 'Ulster', time: '19:45', day: 'Saturday 28th February' }
                ]
            },
            13: {
                teams: ['Bulls', 'Cardiff Rugby', 'Scarlets', 'Zebre', 'Ulster', 'Connacht', 'Lions', 'Edinburgh', 'Benetton Rugby', 'Ospreys', 'Sharks', 'Munster', 'Glasgow Warriors', 'Leinster', 'Stormers', 'Dragons'],
                matches: [
                    { id: 'r13g1', home: 'Bulls', away: 'Cardiff Rugby', time: '17:00', day: 'Friday 20th March' },
                    { id: 'r13g2', home: 'Scarlets', away: 'Zebre', time: '19:45', day: 'Friday 20th March' },
                    { id: 'r13g3', home: 'Ulster', away: 'Connacht', time: '19:45', day: 'Friday 20th March' },
                    { id: 'r13g4', home: 'Lions', away: 'Edinburgh', time: '12:45', day: 'Saturday 21st March' },
                    { id: 'r13g5', home: 'Benetton Rugby', away: 'Ospreys', time: '15:00', day: 'Saturday 21st March' },
                    { id: 'r13g6', home: 'Sharks', away: 'Munster', time: '15:00', day: 'Saturday 21st March' },
                    { id: 'r13g7', home: 'Glasgow Warriors', away: 'Leinster', time: '17:30', day: 'Saturday 21st March' },
                    { id: 'r13g8', home: 'Stormers', away: 'Dragons', time: '17:30', day: 'Saturday 21st March' }
                ]
            },
            14: {
                teams: ['Sharks', 'Cardiff Rugby', 'Glasgow Warriors', 'Benetton Rugby', 'Bulls', 'Munster', 'Connacht', 'Ospreys', 'Lions', 'Dragons', 'Stormers', 'Edinburgh', 'Leinster', 'Scarlets', 'Zebre', 'Ulster'],
                matches: [
                    { id: 'r14g1', home: 'Sharks', away: 'Cardiff Rugby', time: '17:00', day: 'Friday 27th March' },
                    { id: 'r14g2', home: 'Glasgow Warriors', away: 'Benetton Rugby', time: '19:45', day: 'Friday 27th March' },
                    { id: 'r14g3', home: 'Bulls', away: 'Munster', time: '12:00', day: 'Saturday 28th March' },
                    { id: 'r14g4', home: 'Connacht', away: 'Ospreys', time: '14:15', day: 'Saturday 28th March' },
                    { id: 'r14g5', home: 'Lions', away: 'Dragons', time: '14:30', day: 'Saturday 28th March' },
                    { id: 'r14g6', home: 'Stormers', away: 'Edinburgh', time: '17:00', day: 'Saturday 28th March' },
                    { id: 'r14g7', home: 'Leinster', away: 'Scarlets', time: '17:30', day: 'Saturday 28th March' },
                    { id: 'r14g8', home: 'Zebre', away: 'Ulster', time: '19:45', day: 'Saturday 28th March' }
                ]
            },
            15: {
                teams: ['Dragons', 'Bulls', 'Edinburgh', 'Zebre', 'Ulster', 'Leinster', 'Lions', 'Glasgow Warriors', 'Stormers', 'Connacht', 'Scarlets', 'Cardiff Rugby', 'Benetton Rugby', 'Munster', 'Ospreys', 'Sharks'],
                matches: [
                    { id: 'r15g1', home: 'Dragons', away: 'Bulls', time: '19:45', day: 'Friday 17th April' },
                    { id: 'r15g2', home: 'Edinburgh', away: 'Zebre', time: '19:45', day: 'Friday 17th April' },
                    { id: 'r15g3', home: 'Ulster', away: 'Leinster', time: '19:45', day: 'Friday 17th April' },
                    { id: 'r15g4', home: 'Lions', away: 'Glasgow Warriors', time: '14:45', day: 'Saturday 18th April' },
                    { id: 'r15g5', home: 'Stormers', away: 'Connacht', time: '17:15', day: 'Saturday 18th April' },
                    { id: 'r15g6', home: 'Scarlets', away: 'Cardiff Rugby', time: '17:30', day: 'Saturday 18th April' },
                    { id: 'r15g7', home: 'Benetton Rugby', away: 'Munster', time: '19:45', day: 'Saturday 18th April' },
                    { id: 'r15g8', home: 'Ospreys', away: 'Sharks', time: '19:45', day: 'Saturday 18th April' }
                ]
            },
            16: {
                teams: ['Cardiff Rugby', 'Ospreys', 'Edinburgh', 'Sharks', 'Zebre', 'Dragons', 'Lions', 'Connacht', 'Munster', 'Ulster', 'Stormers', 'Glasgow Warriors', 'Benetton Rugby', 'Leinster', 'Scarlets', 'Bulls'],
                matches: [
                    { id: 'r16g1', home: 'Cardiff Rugby', away: 'Ospreys', time: '19:45', day: 'Friday 24th April' },
                    { id: 'r16g2', home: 'Edinburgh', away: 'Sharks', time: '19:45', day: 'Friday 24th April' },
                    { id: 'r16g3', home: 'Zebre', away: 'Dragons', time: '19:45', day: 'Friday 24th April' },
                    { id: 'r16g4', home: 'Lions', away: 'Connacht', time: '15:00', day: 'Saturday 25th April' },
                    { id: 'r16g5', home: 'Munster', away: 'Ulster', time: '17:30', day: 'Saturday 25th April' },
                    { id: 'r16g6', home: 'Stormers', away: 'Glasgow Warriors', time: '17:30', day: 'Saturday 25th April' },
                    { id: 'r16g7', home: 'Benetton Rugby', away: 'Leinster', time: '19:45', day: 'Saturday 25th April' },
                    { id: 'r16g8', home: 'Scarlets', away: 'Bulls', time: '19:45', day: 'Saturday 25th April' }
                ]
            },
            17: {
                teams: ['TBD', 'TBD', 'TBD', 'TBD'],
                matches: [
                    { id: 'sf1', home: 'TBD', away: 'TBD', time: 'TBD', day: 'Friday 6th June' },
                    { id: 'sf2', home: 'TBD', away: 'TBD', time: 'TBD', day: 'Friday 6th June' }
                ]
            },
            18: {
                teams: ['TBD', 'TBD'],
                matches: [
                    { id: 'final', home: 'TBD', away: 'TBD', time: 'TBD', day: 'Friday 20th June' }
                ]
            }
        };

        let showEliminated = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadGameData();
            setupEventListeners();
            updateGameStatus();
            updateUI();
            try { generateTeamButtons(); } catch (e) {}
            // Ensure render after any late layout/JS work
            setTimeout(() => { try { generateTeamButtons(); } catch (e) {} }, 0);
            setTimeout(() => { try { generateTeamButtons(); } catch (e) {} }, 200);
            // Force show Current Round tab on load
            try { switchFixtureTab('current'); } catch (e) {}
            // Keep trying briefly until buttons appear
            let _tries = 0; (function ensureTeamButtons(){
                const c = document.getElementById('teamButtons');
                if (c && c.childElementCount > 0) return;
                try { generateTeamButtons(); } catch (e) {}
                if (_tries++ < 20) setTimeout(ensureTeamButtons, 100);
            })();
            setInterval(() => {
                updateGameStatus();
            }, 1000);
        });

        function setupEventListeners() {
            // Auth tabs
            document.getElementById('loginTab').addEventListener('click', () => switchTab('login'));
            document.getElementById('registerTab').addEventListener('click', () => switchTab('register'));
            
            // Auth form
            document.getElementById('authForm').addEventListener('submit', handleAuth);
            
            // Game mode toggles
            
            
            // LMS Navigation tabs
            document.getElementById('currentRoundTab').addEventListener('click', () => switchFixtureTab('current'));
            document.getElementById('fixturesTab').addEventListener('click', () => switchFixtureTab('all'));
            
            // Pick it! Navigation tabs
            
            
            // Round selectors
            document.getElementById('roundSelector').addEventListener('change', updateAllFixtures);
            
            
            // Confirm pick
            document.getElementById('confirmPick').addEventListener('click', confirmPick);
            
            
            // Toggle eliminated (panel removed ‚Äî guard)
            const toggleEliminatedBtn = document.getElementById('toggleEliminated');
            if (toggleEliminatedBtn) toggleEliminatedBtn.addEventListener('click', toggleEliminatedPlayers);
            
            // View picks modal
            document.getElementById('viewPicksCard').addEventListener('click', openPicksModal);
            document.getElementById('closePicksModal').addEventListener('click', closePicksModal);
            
            // Player list modals
            document.getElementById('standingPlayersCard').addEventListener('click', () => openPlayerListModal('standing'));
            document.getElementById('eliminatedPlayersCard').addEventListener('click', () => openPlayerListModal('eliminated'));
            const closePlayerListBtn = document.getElementById('closePlayerListModal');
            if (closePlayerListBtn) closePlayerListBtn.addEventListener('click', closePlayerListModal);
            
            // Admin modal
            document.getElementById('adminScores').addEventListener('click', openAdminModal);
            document.getElementById('closeAdminModal').addEventListener('click', closeAdminModal);
            
            // Admin tabs
            document.getElementById('adminScoresTab').addEventListener('click', () => switchAdminTab('scores'));
            document.getElementById('adminPlayersTab').addEventListener('click', () => switchAdminTab('players'));
            
            // Admin round selector
            document.getElementById('adminRoundSelector').addEventListener('change', populateAdminScores);
            
            // Admin tabs
            document.getElementById('adminPlayoffsTab').addEventListener('click', () => switchAdminTab('playoffs'));
            
            // Chat functionality
            
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Settings
            document.getElementById('settingsBtn').addEventListener('click', openSettingsModal);
            document.getElementById('closeSettingsModal').addEventListener('click', closeSettingsModal);
            document.getElementById('settingsForm').addEventListener('submit', saveSettings);
            document.getElementById('cancelSettings').addEventListener('click', closeSettingsModal);
            
            // Profile modal
            document.getElementById('closeProfileModal').addEventListener('click', closeProfileModal);
            
            // Password reset
            document.getElementById('forgotPasswordBtn').addEventListener('click', showPasswordReset);
            document.getElementById('resetPasswordBtn').addEventListener('click', resetPassword);
            document.getElementById('cancelResetBtn').addEventListener('click', hidePasswordReset);
            
            // Email verification
            document.getElementById('resendCode').addEventListener('click', resendVerificationCode);
            
            // Custom profile picture uploads
            document.getElementById('customProfilePic').addEventListener('change', handleCustomProfilePic);
            document.getElementById('removeCustomPic').addEventListener('click', removeCustomProfilePic);
            document.getElementById('settingsCustomProfilePic').addEventListener('change', handleSettingsCustomProfilePic);
            document.getElementById('settingsRemoveCustomPic').addEventListener('click', removeSettingsCustomProfilePic);

            // Sync modal
            document.getElementById('syncSettingsBtn').addEventListener('click', () => {
                document.getElementById('syncUrlInput').value = syncUrl || '';
                document.getElementById('syncModal').classList.remove('hidden');
            });
            document.getElementById('closeSyncModal').addEventListener('click', () => document.getElementById('syncModal').classList.add('hidden'));
            document.getElementById('saveSyncUrl').addEventListener('click', () => {
                const url = document.getElementById('syncUrlInput').value;
                setSyncUrl(url);
                document.getElementById('syncModal').classList.add('hidden');
                showNotification('Sync URL saved', 'success');
                syncPullAndMaybeUpdate();
            });
            document.getElementById('clearSyncUrl').addEventListener('click', () => {
                setSyncUrl(null);
                document.getElementById('syncModal').classList.add('hidden');
                showNotification('Sync disabled', 'info');
            });
        }

        function loadGameData() {
            const saved = localStorage.getItem('urcGameData');
            if (saved) {
                gameData = { ...gameData, ...JSON.parse(saved) };
            }
            // Auto-attach current user if we previously stored an email
            const savedEmail = localStorage.getItem('currentUserEmail');
            if (savedEmail && Array.isArray(gameData.players)) {
                const player = gameData.players.find(p => normalizeEmail(p.email) === normalizeEmail(savedEmail));
                if (player) {
                    currentUser = player;
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    document.getElementById('userName').textContent = player.displayName;
                }
            }
            // Initial remote sync pull
            syncPullAndMaybeUpdate();
            // Periodic poll
            setInterval(syncPullAndMaybeUpdate, 10000);
        }

        function saveGameData() {
            gameData.updatedAt = Date.now();
            localStorage.setItem('urcGameData', JSON.stringify(gameData));
            scheduleSyncPush();
        }

        function resetVerificationState() {
            // Reset verification state when switching tabs
            verificationState = {
                email: null,
                code: null,
                expiresAt: null,
                attempts: 0,
                maxAttempts: 3,
                timer: null
            };
        }

        function switchTab(tab) {
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const nameField = document.getElementById('nameField');
            const profilePicField = document.getElementById('profilePicField');
            const favoriteTeamField = document.getElementById('favoriteTeamField');
            const passwordHelp = document.getElementById('passwordHelp');
            const authButton = document.getElementById('authButton');
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            const passwordResetForm = document.getElementById('passwordResetForm');
            
            resetVerificationState();
            
            // Hide password reset form when switching tabs
            passwordResetForm.classList.add('hidden');
            
            if (tab === 'login') {
                loginTab.className = 'flex-1 py-2 px-4 bg-blue-600 text-white rounded-l-lg font-medium';
                registerTab.className = 'flex-1 py-2 px-4 bg-gray-200 text-gray-700 rounded-r-lg font-medium';
                nameField.classList.add('hidden');
                profilePicField.classList.add('hidden');
                favoriteTeamField.classList.add('hidden');
                passwordHelp.classList.add('hidden');
                forgotPasswordLink.classList.remove('hidden');
                authButton.textContent = 'Login';
            } else {
                loginTab.className = 'flex-1 py-2 px-4 bg-gray-200 text-gray-700 rounded-l-lg font-medium';
                registerTab.className = 'flex-1 py-2 px-4 bg-blue-600 text-white rounded-r-lg font-medium';
                nameField.classList.remove('hidden');
                profilePicField.classList.remove('hidden');
                favoriteTeamField.classList.remove('hidden');
                passwordHelp.classList.remove('hidden');
                forgotPasswordLink.classList.add('hidden');
                authButton.textContent = 'Register';
            }
        }

        function handleAuth(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const displayName = document.getElementById('displayName').value;
            const authButtonText = document.getElementById('authButton').textContent;
            
            if (authButtonText === 'Login') {
                loginUser(email, password);
            } else if (authButtonText === 'Register') {
                registerUser(email, password, displayName);
            }
        }

        // Enhanced profanity filter function
        function containsProfanity(text) {
            if (!text) return false;
            const profanityList = [
                'fuck', 'shit', 'damn', 'bitch', 'asshole', 'bastard', 'cunt', 'dick', 'piss', 'cock', 'pussy', 'whore', 'slut', 'fag', 'nigger', 'retard',
                'f*ck', 'sh*t', 'b*tch', 'a**hole', 'c*nt', 'd*ck', 'p*ss', 'wh*re', 'sl*t',
                'fck', 'sht', 'btch', 'cnt', 'dck', 'pss', 'whr', 'slt',
                'fucker', 'fucking', 'fucked', 'shitty', 'shitting', 'bitchy', 'dickhead', 'pissed',
                'sex', 'porn', 'xxx', 'anal', 'oral', 'nude', 'naked', 'boobs', 'tits', 'ass',
                'hate', 'kill', 'die', 'death', 'murder', 'suicide', 'nazi', 'hitler',
                'stupid', 'idiot', 'moron', 'dumb', 'loser', 'gay', 'homo', 'lesbian'
            ];
            const lowerText = text.toLowerCase().replace(/[^a-z0-9]/g, '');
            return profanityList.some(word => {
                const cleanWord = word.replace(/[^a-z0-9]/g, '');
                return lowerText.includes(cleanWord);
            });
        }

        function registerUser(email, password, displayName) {
            email = normalizeEmail(email);
            const existingPlayer = gameData.players.find(p => normalizeEmail(p.email) === email);
            if (existingPlayer) {
                showNotification('Email already registered! Please login instead.', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters long', 'error');
                return;
            }
            
            if (containsProfanity(displayName)) {
                showNotification('Display name contains inappropriate language. Please choose a different name.', 'error');
                return;
            }
            
            const newPlayer = {
                id: Date.now(),
                email: email,
                password: password,
                displayName: displayName || email.split('@')[0],
                profilePic: registrationData.profilePic,
                isCustomPic: registrationData.isCustomPic || false,
                favoriteTeam: document.getElementById('favoriteTeam').value,
                isEliminated: false,
                usedTeams: [],
                currentPick: null,
                roundJoined: gameData.currentRound,
                joinDate: new Date().toISOString(),
                // Pick it! game data
                pickItPicks: {}, // roundNum: {matchId: teamPicked}
                pickItStats: {
                    totalPicks: 0,
                    correctPicks: 0,
                    percentage: 0,
                    weeklyMovement: 0,
                    previousRank: null
                }
            };
            
            gameData.players.push(newPlayer);
            saveGameData();
            
            showNotification('Registration successful! You can now login and start playing.', 'success');
            
            switchTab('login');
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('displayName').value = '';
        }



        function handleCustomProfilePic(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 2 * 1024 * 1024) {
                showNotification('Image must be smaller than 2MB', 'error');
                e.target.value = '';
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showNotification('Please select an image file', 'error');
                e.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const imageData = event.target.result;
                
                document.getElementById('customPicImage').src = imageData;
                document.getElementById('customPicPreview').classList.remove('hidden');
                
                registrationData.profilePic = imageData;
                registrationData.isCustomPic = true;
            };
            reader.readAsDataURL(file);
        }
        
        function removeCustomProfilePic() {
            document.getElementById('customPicPreview').classList.add('hidden');
            document.getElementById('customProfilePic').value = '';
            registrationData.profilePic = null;
            registrationData.isCustomPic = false;
        }
        
        function handleSettingsCustomProfilePic(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 2 * 1024 * 1024) {
                showNotification('Image must be smaller than 2MB', 'error');
                e.target.value = '';
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showNotification('Please select an image file', 'error');
                e.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const imageData = event.target.result;
                
                document.getElementById('settingsCustomPicImage').src = imageData;
                document.getElementById('settingsCustomPicPreview').classList.remove('hidden');
                
                window.tempCustomPic = imageData;
            };
            reader.readAsDataURL(file);
        }
        
        function removeSettingsCustomProfilePic() {
            document.getElementById('settingsCustomPicPreview').classList.add('hidden');
            document.getElementById('settingsCustomProfilePic').value = '';
            window.tempCustomPic = null;
        }

        function loginUser(email, password) {
            email = normalizeEmail(email);
            const player = gameData.players.find(p => normalizeEmail(p.email) === email);
            if (!player) {
                showNotification('Email not found. Please register first.', 'error');
                return;
            }
            
            if (player.password !== password) {
                showNotification('Incorrect password. Please try again.', 'error');
                return;
            }
            
            currentUser = player;
            localStorage.setItem('currentUserEmail', email);
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userName').textContent = player.displayName;
            try { generateTeamButtons(); } catch (e) {}
            
            const userProfilePicElement = document.getElementById('userProfilePic');
            if (player.isCustomPic && player.profilePic && player.profilePic.startsWith('data:')) {
                userProfilePicElement.innerHTML = `<img src="${player.profilePic}" class="w-8 h-8 rounded-full object-cover border border-gray-300" alt="Profile">`;
            } else {
                userProfilePicElement.innerHTML = `<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRgMFCSXJWsbmkra95ltt9Z9LJiRuMOsIBluqwF-g4&usqp=CAE&s" class="w-8 h-8 rounded-full object-cover border border-gray-300" alt="Profile" onerror="this.src=''; this.style.display='none'; this.nextElementSibling.style.display='block';"><div class="w-8 h-8 rounded-full bg-gray-300 border border-gray-400" style="display: none;"></div>`;
            }
            
            if (email === 'sacksjordan@gmail.com') {
                document.getElementById('adminScores').classList.remove('hidden');
            } else {
                document.getElementById('adminScores').classList.add('hidden');
            }
            
            showNotification(`Welcome back, ${player.displayName}!`, 'success');
            updateUI();
            try { generateTeamButtons(); } catch (e) {}
            setTimeout(() => { try { generateTeamButtons(); } catch (e) {} }, 0);
        }



        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUserEmail');
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('displayName').value = '';
        }

        function selectTeam(teamName) {
            const status = calculatePickingStatus();
            if (!status.isOpen || currentUser.isEliminated) return;
            
            const roundData = roundFixtures[gameData.currentRound];
            const availableTeams = roundData ? roundData.teams : [];
            if (!availableTeams.includes(teamName)) {
                alert('This team is not playing in the current round!');
                return;
            }
            
            // Disallow previously used teams from prior rounds, but allow changing within this round
            if (!Array.isArray(currentUser.usedTeams)) currentUser.usedTeams = [];
            const startRound = currentUser.roundJoined || 1;
            const roundIndex = Math.max(0, (gameData.currentRound || 1) - startRound);
            const usedPreviously = currentUser.usedTeams
                .slice(0, roundIndex)
                .filter(t => !!t)
                .includes(teamName);
            if (usedPreviously) {
                alert('You have already used this team in a previous round!');
                return;
            }
            
            document.querySelectorAll('.team-btn').forEach(btn => {
                if (!btn.disabled) {
                    btn.classList.remove('border-blue-500', 'bg-blue-100');
                    btn.classList.add('border-gray-200');
                }
            });
            
            const selectedBtn = document.querySelector(`[data-team="${teamName}"]`);
            if (selectedBtn && !selectedBtn.disabled) {
                selectedBtn.classList.add('border-blue-500', 'bg-blue-100');
                selectedBtn.classList.remove('border-gray-200');
            }
            
            document.getElementById('selectedTeam').classList.remove('hidden');
            document.getElementById('selectedTeamName').textContent = teamName;
            const btn = document.getElementById('confirmPick');
            btn.disabled = false;
            btn.textContent = currentUser.currentPick ? 'Change Pick' : 'Confirm Pick';
            
            currentUser.tempPick = teamName;
        }

        function confirmPick() {
            const status = calculatePickingStatus();
            if (!status.isOpen || currentUser.isEliminated) return;
            if (!currentUser.tempPick && currentUser.currentPick) return; // nothing to change
            if (!currentUser.tempPick) return;
            
            // Set current pick and update usedTeams at the correct round index
            currentUser.currentPick = currentUser.tempPick;
            const startRound = currentUser.roundJoined || 1;
            const roundIndex = Math.max(0, (gameData.currentRound || 1) - startRound);
            if (!Array.isArray(currentUser.usedTeams)) currentUser.usedTeams = [];
            if (roundIndex < currentUser.usedTeams.length) {
                currentUser.usedTeams[roundIndex] = currentUser.tempPick;
            } else if (roundIndex === currentUser.usedTeams.length) {
                currentUser.usedTeams.push(currentUser.tempPick);
            } else {
                while (currentUser.usedTeams.length < roundIndex) currentUser.usedTeams.push(null);
                currentUser.usedTeams.push(currentUser.tempPick);
            }
            currentUser.tempPick = null;
            saveGameData();
            updateUI();
            showNotification('Pick confirmed! Good luck!', 'success');
        }



        function switchFixtureTab(tab) {
            const currentTab = document.getElementById('currentRoundTab');
            const fixturesTab = document.getElementById('fixturesTab');
            const currentSection = document.getElementById('currentRoundSection');
            const allSection = document.getElementById('allFixturesSection');
            
            if (tab === 'current') {
                currentTab.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg font-medium';
                fixturesTab.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium';
                currentSection.classList.remove('hidden');
                allSection.classList.add('hidden');
                try { generateTeamButtons(); } catch (e) {}
                // Also rebuild when tab becomes visible in case of earlier timing issues
                setTimeout(() => { try { generateTeamButtons(); } catch (e) {} }, 0);
            } else {
                currentTab.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium';
                fixturesTab.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg font-medium';
                currentSection.classList.add('hidden');
                allSection.classList.remove('hidden');
                updateAllFixtures();
            }
        }

        function updateAllFixtures() {
            const selectedRound = document.getElementById('roundSelector').value;
            const content = document.getElementById('allFixturesContent');
            
            let html = '';
            
            if (selectedRound === 'all') {
                // Show all rounds
                Object.keys(roundFixtures).forEach(roundNum => {
                    const roundData = roundFixtures[roundNum];
                    html += `
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-3">Round ${roundNum}</h4>
                            <div class="space-y-2">
                    `;
                    
                    // Group matches by day
                    const matchesByDay = {};
                    roundData.matches.forEach(match => {
                        if (!matchesByDay[match.day]) {
                            matchesByDay[match.day] = [];
                        }
                        matchesByDay[match.day].push(match);
                    });
                    
                    Object.keys(matchesByDay).forEach(day => {
                        html += `
                            <div class="mb-3">
                                <h5 class="font-medium text-gray-700 mb-2">${day}</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        `;
                        
                        matchesByDay[day].forEach(match => {
                            const result = gameData.matchResults[match.id];
                            let statusDisplay = '';
                            
            if (result && result.finished) {
                statusDisplay = `<span class="text-xs text-green-700 font-semibold">FT: <span class="font-bold">${result.winner}</span></span>`;
            } else if (isMatchLive(match)) {
                                statusDisplay = `<span class="text-xs text-red-600 font-medium animate-pulse">üî¥ LIVE</span>`;
                            } else {
                                statusDisplay = `<span class="text-xs text-gray-500">${match.time}</span>`;
                            }
                            
                            html += `
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                                    <span>${match.home} vs ${match.away}</span>
                                    ${statusDisplay}
                                </div>
                            `;
                        });
                        
                        html += `
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
            } else {
                // Show specific round
                const roundData = roundFixtures[selectedRound];
                if (roundData) {
                    html += `
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-3">Round ${selectedRound}</h4>
                            <div class="space-y-2">
                    `;
                    
                    // Group matches by day
                    const matchesByDay = {};
                    roundData.matches.forEach(match => {
                        if (!matchesByDay[match.day]) {
                            matchesByDay[match.day] = [];
                        }
                        matchesByDay[match.day].push(match);
                    });
                    
                    Object.keys(matchesByDay).forEach(day => {
                        html += `
                            <div class="mb-3">
                                <h5 class="font-medium text-gray-700 mb-2">${day}</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        `;
                        
                        matchesByDay[day].forEach(match => {
                            const result = gameData.matchResults[match.id];
                            let statusDisplay = '';
                            
            if (result && result.finished) {
                statusDisplay = `<span class="text-xs text-green-700 font-semibold">FT: <span class="font-bold">${result.winner}</span></span>`;
            } else if (isMatchLive(match)) {
                                statusDisplay = `<span class="text-xs text-red-600 font-medium animate-pulse">üî¥ LIVE</span>`;
                            } else {
                                statusDisplay = `<span class="text-xs text-gray-500">${match.time}</span>`;
                            }
                            
                            html += `
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded border">
                                    <span>${match.home} vs ${match.away}</span>
                                    ${statusDisplay}
                                </div>
                            `;
                        });
                        
                        html += `
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
            }
            
            content.innerHTML = html || '<div class="text-center text-gray-500 py-8">No fixtures available</div>';
            try { generateTeamButtons(); } catch (e) {}
        }

        function updateGameStatus() {
            const status = calculatePickingStatus();
            gameData.pickingOpen = status.isOpen;
            
            const statusMsgEl = document.getElementById('statusMessage');
            const countdownEl = document.getElementById('countdown');
            const lmsInline = document.getElementById('lmsCountdownInline');
            const currentRoundCountdown = document.getElementById('currentRoundCountdown');
            const allFixturesCountdown = document.getElementById('allFixturesCountdown');

            if (statusMsgEl) statusMsgEl.textContent = status.message;
            if (countdownEl) countdownEl.textContent = status.timeUntil || '';

            // Compose rich inline block: show deadline in UK and local, plus state
            if (lmsInline) {
                let line = '';
                if (status.deadline) {
                    const { uk, local } = formatInTimeZones(status.deadline);
                    line += `Deadline (UK): ${uk}`;
                    if (local !== uk) line += ` ¬∑ Your time: ${local}`;
                }
                if (status.isOpen) {
                    line = `üü¢ Picking OPEN ‚Äî ${status.timeUntil}` + (line ? ` ¬∑ ${line}` : '');
                } else if (status.earliestKickoff && new Date() < status.earliestKickoff) {
                    line = `üîí Locked ‚Äî ${status.timeUntil}` + (line ? ` ¬∑ ${line}` : '');
                } else {
                    line = `üü° Round Started` + (line ? ` ¬∑ ${line}` : '');
                }
                lmsInline.textContent = line;
            }

            if (currentRoundCountdown) {
                currentRoundCountdown.textContent = status.isOpen ? `‚è≥ Round Open ‚Äî ${status.timeUntil}` : (status.roundStart && new Date() < status.roundStart ? `üîí Opens soon` : 'üü° Round Started');
            }
            if (allFixturesCountdown) {
                allFixturesCountdown.textContent = status.isOpen ? `‚è≥ Round Open ‚Äî ${status.timeUntil}` : (status.roundStart && new Date() < status.roundStart ? `üîí Opens soon` : 'üü° Round Started');
            }
            
            // Update round status indicator
            const indicator = document.getElementById('roundStatusIndicator');
            if (indicator) {
                if (status.isOpen) {
                    indicator.className = 'mt-3 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800';
                    indicator.innerHTML = 'üü¢ Round Open - Picking Available';
                } else if (status.earliestKickoff && new Date() < status.earliestKickoff) {
                    indicator.className = 'mt-3 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-amber-100 text-amber-800';
                    indicator.innerHTML = 'üîí Locked ‚Äî Awaiting Kick-off';
                } else {
                    indicator.className = 'mt-3 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800';
                    indicator.innerHTML = 'üü° Round Started';
                }
            }

            // Always (re)build team buttons so they are visible regardless of mode toggles
            try { generateTeamButtons(); } catch (e) {}
            setTimeout(() => { try { generateTeamButtons(); } catch (e) {} }, 0);
        }

        function generateTeamButtons() {
            const teamButtonsContainer = document.getElementById('teamButtons');
            if (!teamButtonsContainer) return;
            const roundData = roundFixtures[gameData.currentRound];
            let availableTeams = roundData ? roundData.teams : [];
            // Fallback: if for any reason current round data is missing, show union of all teams
            if (!availableTeams || availableTeams.length === 0) {
                const teamSet = new Set();
                Object.keys(roundFixtures).forEach(key => {
                    const rd = roundFixtures[key];
                    (rd?.teams || []).forEach(t => { if (t && t !== 'TBD') teamSet.add(t); });
                });
                availableTeams = Array.from(teamSet);
            }
            // Ensure container is visible
            const currentSection = document.getElementById('currentRoundSection');
            if (currentSection) currentSection.classList.remove('hidden');
            const currentTab = document.getElementById('currentRoundTab');
            const fixturesTab = document.getElementById('fixturesTab');
            if (currentTab && fixturesTab) {
                currentTab.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg font-medium';
                fixturesTab.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium';
            }
            let status;
            try {
                status = calculatePickingStatus();
            } catch (e) {
                status = { isOpen: !!gameData.pickingOpen };
            }
            
            teamButtonsContainer.innerHTML = '';
            
            const hasUser = !!currentUser;
            const userUsedTeams = hasUser && Array.isArray(currentUser.usedTeams) ? currentUser.usedTeams : [];
            const current = hasUser ? currentUser.currentPick : null;
            const isEliminated = hasUser ? !!currentUser.isEliminated : true; // if no user, disable interactions
            
            availableTeams.forEach(team => {
                const isUsed = hasUser && userUsedTeams.includes(team);
                const isDisabled = isUsed || !status.isOpen || isEliminated;
                
                const button = document.createElement('button');
                button.className = `team-btn p-3 border-2 rounded-lg transition-colors ${
                    isDisabled 
                        ? 'border-gray-400 bg-gray-200 text-gray-500 cursor-not-allowed opacity-60' 
                        : 'border-gray-200 hover:border-blue-500 hover:bg-blue-50'
                }`;
                button.dataset.team = team;
                button.disabled = isDisabled;
                
                if (current && team === current) {
                    button.innerHTML = `${team} <span class="text-xs">‚úì</span>`;
                    button.classList.add('border-green-500','bg-green-50');
                } else if (isUsed) {
                    button.innerHTML = `${team} <span class="text-xs">‚úó</span>`;
                } else if (!status.isOpen) {
                    button.innerHTML = `${team} <span class="text-xs">üîí</span>`;
                } else {
                    button.innerHTML = team;
                }
                
                if (!isDisabled) {
                    button.addEventListener('click', () => selectTeam(team));
                }
                
                teamButtonsContainer.appendChild(button);
            });
        }

        // Game mode switching
        function switchGameMode(mode) {
            // Simplified: LMS only
            currentGameMode = 'lms';
            const lmsInterface = document.getElementById('lmsInterface');
            if (lmsInterface) lmsInterface.classList.remove('hidden');
            updateUI();
        }

        // Pick it! tab switching
        function switchPickItTab() {}

        function updateUI() {
            // Render teams even if not logged in to avoid empty UI; interactions still guarded
            
            const currentRoundEl = document.getElementById('currentRound');
            if (currentRoundEl) currentRoundEl.textContent = gameData.currentRound;
            
            
            if (currentGameMode === 'lms') {
                // Update LMS stats
                const standingPlayers = gameData.players.filter(p => !p.isEliminated);
                const eliminatedPlayers = gameData.players.filter(p => p.isEliminated);
                
                document.getElementById('playersStanding').textContent = standingPlayers.length;
                document.getElementById('playersEliminated').textContent = eliminatedPlayers.length;
                document.getElementById('totalPlayers').textContent = gameData.players.length;
                
                // Show/hide eliminated toggle button (guarded)
                const toggleBtn = document.getElementById('toggleEliminated');
                if (toggleBtn) {
                    if (eliminatedPlayers.length > 0) toggleBtn.classList.remove('hidden');
                    else toggleBtn.classList.add('hidden');
                }
                
                generateTeamButtons();
                
                const status = calculatePickingStatus();
                if (currentUser && currentUser.currentPick) {
                    document.getElementById('selectedTeam').classList.remove('hidden');
                    document.getElementById('selectedTeamName').textContent = currentUser.currentPick;
                    const btn = document.getElementById('confirmPick');
                    if (status.isOpen) {
                        btn.textContent = 'Change Pick';
                        btn.disabled = false;
                        btn.classList.remove('bg-gray-400','bg-green-500');
                        btn.classList.add('bg-green-600','hover:bg-green-700');
                    } else {
                        btn.textContent = 'Round In Progress';
                        btn.disabled = true;
                        btn.classList.remove('bg-green-600','hover:bg-green-700');
                        btn.classList.add('bg-gray-400');
                    }
                } else if (currentUser) {
                    const btn = document.getElementById('confirmPick');
                    if (status.isOpen) {
                        btn.textContent = 'Confirm Pick';
                        btn.disabled = true; // until a team selected
                        btn.classList.remove('bg-gray-400');
                        btn.classList.add('bg-green-600','hover:bg-green-700');
                    } else {
                        btn.textContent = 'Round In Progress';
                        btn.disabled = true;
                        btn.classList.remove('bg-green-600','hover:bg-green-700');
                        btn.classList.add('bg-gray-400');
                    }
                }
            }
        }

        function updatePickItStats() {}

        function updatePickItInterface() {}

        function makePickItPick() {}

        function savePickItPicks() {}

        // Admin: reset Pick It picks for a player (current round)
        function resetPickItRound(playerId, roundNum) {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            const player = gameData.players.find(p => p.id == playerId);
            if (!player) return;
            if (player.pickItPicks && player.pickItPicks[roundNum]) {
                delete player.pickItPicks[roundNum];
                saveGameData();
                showNotification(`Reset Pick It picks for ${player.displayName} in Round ${roundNum}`, 'success');
                updatePickItInterface();
                populateAdminPlayers();
            }
        }

        // Admin: reset all Pick It picks for a player
        function resetPickItAll(playerId) {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            const player = gameData.players.find(p => p.id == playerId);
            if (!player) return;
            player.pickItPicks = {};
            player.pickItStats = { totalPicks: 0, correctPicks: 0, percentage: 0, weeklyMovement: 0, previousRank: null };
            saveGameData();
            showNotification(`Reset all Pick It picks for ${player.displayName}`, 'success');
            updatePickItInterface();
            populateAdminPlayers();
        }

        function calculatePickItLeaderboard() {
            return gameData.players
                .map(player => {
                    const stats = computeAndUpdatePlayerPickItStats(player);
                    return {
                        ...player,
                        percentage: stats.totalPicks > 0 ? (stats.correctPicks / stats.totalPicks) * 100 : 0
                    };
                })
                .sort((a, b) => {
                    if (b.percentage !== a.percentage) {
                        return b.percentage - a.percentage;
                    }
                    return (b.pickItStats?.correctPicks || 0) - (a.pickItStats?.correctPicks || 0);
                });
        }

        function updatePickItLeaderboard() {
            const container = document.getElementById('pickItLeaderboardContent');
            const leaderboard = calculatePickItLeaderboard();
            
            if (leaderboard.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">No picks made yet</div>';
                return;
            }
            
            let html = '';
            leaderboard.forEach((player, index) => {
                const rank = index + 1;
                const movement = player.pickItStats.weeklyMovement || 0;
                let movementIcon = '';
                
                if (movement > 0) {
                    movementIcon = `<span class="text-green-600 text-xs">‚Üó +${movement}</span>`;
                } else if (movement < 0) {
                    movementIcon = `<span class="text-red-600 text-xs">‚Üò ${movement}</span>`;
                } else {
                    movementIcon = `<span class="text-gray-400 text-xs">-</span>`;
                }
                
                const isCurrentUser = player.id === currentUser?.id;
                const bgClass = isCurrentUser ? 'bg-green-50 border-green-200' : 'bg-gray-50';
                
                html += `
                    <div class="flex items-center justify-between p-4 border rounded-lg ${bgClass}">
                        <div class="flex items-center space-x-3">
                            <div class="text-lg font-bold text-gray-600">#${rank}</div>
                            <div>
                                <div class="font-medium ${isCurrentUser ? 'text-green-800' : 'text-gray-800'}">${player.displayName}</div>
                                <div class="text-sm text-gray-600">${player.pickItStats.correctPicks}/${player.pickItStats.totalPicks} correct</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-green-600">${Math.round(player.percentage)}%</div>
                            ${movementIcon}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updatePickItAllFixtures() {
            const selectedRound = document.getElementById('pickItRoundSelector').value;
            const content = document.getElementById('pickItAllFixturesContent');
            
            // Use the same logic as LMS fixtures but show Pick it! specific info
            updateAllFixtures(); // Reuse the existing function
            content.innerHTML = document.getElementById('allFixturesContent').innerHTML;
        }

        function openLeaderboardModal() {
            if (currentGameMode === 'pickit') {
                switchPickItTab('leaderboard');
            }
        }



        function updatePicksStatus() {
            const container = document.getElementById('picksStatusList');
            const standingPlayers = gameData.players.filter(p => !p.isEliminated);
            const status = calculatePickingStatus();
            
            if (standingPlayers.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">No active players</div>';
                return;
            }
            
            // Sort players: picked first, then alphabetically
            standingPlayers.sort((a, b) => {
                if (!!a.currentPick !== !!b.currentPick) {
                    return !!b.currentPick - !!a.currentPick;
                }
                return a.displayName.localeCompare(b.displayName);
            });
            
            let html = '';
            standingPlayers.forEach(player => {
                const hasPick = !!player.currentPick;
                const lockIcon = hasPick ? 'üîí' : '‚ùå';
                const statusClass = hasPick ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800';
                
                // Only show actual pick after round finished OR user is admin OR it's the current user
                let pickText = '';
                const isAdmin = currentUser?.email === 'sacksjordan@gmail.com';
                const isCurrentUser = player.id === currentUser?.id;
                const matchResults = Object.values(gameData.matchResults || {}).filter(r => r.roundNum === gameData.currentRound);
                const roundFinished = matchResults.length > 0 && matchResults.every(r => r.finished);
                
                if (!hasPick) {
                    pickText = 'Not picked';
                } else if (!roundFinished && !isAdmin && !isCurrentUser) {
                    pickText = '<span class="blur-sm">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span>';
                } else {
                    pickText = `<span class=\"font-semibold\">${player.currentPick}</span>`;
                }
                
                let profilePic = '';
                if (player.isCustomPic && player.profilePic && player.profilePic.startsWith('data:')) {
                    profilePic = `<img src="${player.profilePic}" class="w-6 h-6 rounded-full object-cover border border-gray-300" alt="Profile">`;
                } else {
                    profilePic = `<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRgMFCSXJWsbmkra95ltt9Z9LJiRuMOsIBluqwF-g4&usqp=CAE&s" class="w-6 h-6 rounded-full object-cover border border-gray-300" alt="Profile" onerror="this.src=''; this.style.display='none'; this.nextElementSibling.style.display='block';"><div class="w-6 h-6 rounded-full bg-gray-300 border border-gray-400" style="display: none;"></div>`;
                }
                
                html += `
                    <div class="p-3 border rounded-lg ${statusClass}">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                ${profilePic}
                                <span class="font-medium text-sm">${player.displayName}</span>
                            </div>
                            <span class="text-lg">${lockIcon}</span>
                        </div>
                        <div class="text-xs font-medium">${pickText}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updatePlayersList() {}

        function toggleEliminatedPlayers() {}

        function openPicksModal() {
            document.getElementById('modalRoundNumber').textContent = gameData.currentRound;
            
            const picksContent = document.getElementById('picksContent');
            const status = calculatePickingStatus();
            let html = '';
            
            const playersToShow = gameData.players.filter(p => !p.isEliminated).sort((a,b) => a.displayName.localeCompare(b.displayName));
            if (playersToShow.length === 0) {
                html = '<div class="text-center text-gray-500 py-8">No active players</div>';
            } else {
                playersToShow.forEach(player => {
                    const isSelf = currentUser && player.id === currentUser.id;
                    const pick = player.currentPick || null;
                    const pickText = pick ? pick : 'No pick yet';
                    const blur = (!isSelf && status.isOpen && pick) ? 'blur-pick' : '';
                    const rowClass = isSelf ? 'bg-blue-50 border-blue-200' : (pick ? 'bg-green-50 border-green-200' : 'bg-gray-50');
                    html += `
                        <div class="flex justify-between items-center p-3 border rounded-lg ${rowClass}">
                            <span class="font-medium">${player.displayName}</span>
                            <span class="text-sm ${blur}">${pickText}</span>
                        </div>
                    `;
                });
            }
            
            picksContent.innerHTML = html;
            document.getElementById('picksModal').classList.remove('hidden');
        }

        function closePicksModal() {
            document.getElementById('picksModal').classList.add('hidden');
        }

        function openPlayerListModal(type) {
            const modal = document.getElementById('playerListModal');
            const title = document.getElementById('playerListTitle');
            const content = document.getElementById('playerListContent');
            
            let players = [];
            let titleText = '';
            let emptyMessage = '';
            
            if (type === 'standing') {
                players = gameData.players.filter(p => !p.isEliminated);
                titleText = `üü¢ Players Standing (${players.length})`;
                emptyMessage = 'No players remaining';
            } else if (type === 'eliminated') {
                players = gameData.players.filter(p => p.isEliminated);
                titleText = `üíÄ Players Eliminated (${players.length})`;
                emptyMessage = 'No players eliminated yet';
            }
            
            title.textContent = titleText;
            
            if (players.length === 0) {
                content.innerHTML = `<div class="text-center text-gray-500 py-8">${emptyMessage}</div>`;
            } else {
                players.sort((a, b) => a.displayName.localeCompare(b.displayName));
                
                let html = '';
                players.forEach(player => {
                    let profilePic = '';
                    if (player.isCustomPic && player.profilePic && player.profilePic.startsWith('data:')) {
                        profilePic = `<img src="${player.profilePic}" class="w-8 h-8 rounded-full object-cover border border-gray-300 cursor-pointer hover:scale-110 transition-transform" onclick="openProfileModal(${player.id})" alt="Profile">`;
                    } else {
                        profilePic = `<div class="w-8 h-8 rounded-full bg-gray-300 border border-gray-400 cursor-pointer hover:scale-110 transition-transform" onclick="openProfileModal(${player.id})"></div>`;
                    }
                    
                    html += `
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-2 mb-1">
                                ${profilePic}
                                <div class="font-medium text-gray-800 cursor-pointer hover:text-blue-600 transition-colors" onclick="openProfileModal(${player.id})">${player.displayName}</div>
                                ${player.favoriteTeam ? `<span class="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded">${player.favoriteTeam}</span>` : ''}
                            </div>
                        </div>
                    `;
                });
                content.innerHTML = html;
            }
            
            modal.classList.remove('hidden');
        }

        function closePlayerListModal() {
            document.getElementById('playerListModal').classList.add('hidden');
        }

        function openProfileModal(playerId) {
            const player = gameData.players.find(p => p.id == playerId);
            if (!player) return;
            
            const modal = document.getElementById('profileModal');
            const content = document.getElementById('profileContent');
            
            const roundsPlayed = gameData.currentRound - (player.roundJoined || 1);
            const roundsSurvived = player.isEliminated ? (player.eliminatedInRound - (player.roundJoined || 1)) : roundsPlayed;
            
            let pickHistory = '';
            const status = calculatePickingStatus();
            const isAdmin = currentUser?.email === 'sacksjordan@gmail.com';
            const isCurrentUser = player.id === currentUser?.id;
            
            if (player.usedTeams.length > 0) {
                const results = Object.values(gameData.matchResults || {});
                pickHistory = player.usedTeams.map((team, index) => {
                    const roundNum = (player.roundJoined || 1) + index;
                    const roundResults = results.filter(r => r.roundNum === roundNum);
                    const roundFinished = roundResults.length > 0 && roundResults.every(r => r.finished);
                    const teamDisplay = team && roundFinished ? team : '‚Äî';
                    return `<div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-1 py-1">
                        <span>Round ${roundNum}:</span>
                        <span class="font-medium">${teamDisplay}</span>
                    </div>`;
                }).join('');
            } else {
                pickHistory = '<div class="text-gray-500 text-center py-4">No picks made yet</div>';
            }
            
            let seasonStatus = '';
            if (player.isEliminated) {
                seasonStatus = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-2xl">üíÄ</span>
                            <span class="font-semibold text-red-800">Eliminated</span>
                        </div>
                        <p class="text-sm text-red-700">Round ${player.eliminatedInRound}</p>
                        <p class="text-xs text-red-600 mt-1">${player.eliminatedBy || 'Team lost'}</p>
                    </div>
                `;
            } else {
                seasonStatus = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-2xl">‚úÖ</span>
                            <span class="font-semibold text-green-800">Still Standing</span>
                        </div>
                        <p class="text-sm text-green-700">Survived ${roundsSurvived} rounds</p>
                        ${player.currentPick ? `<p class="text-xs text-green-600 mt-1">Current pick: ${status.isOpen && !isAdmin && !isCurrentUser ? '<span class=\"blur-sm\">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span>' : `<span class=\"font-semibold\">${player.currentPick}</span>`}</p>` : ''}
                    </div>
                `;
            }
            
            const joinDate = player.joinDate ? new Date(player.joinDate).toLocaleDateString() : 'Unknown';
            
            let profilePicDisplay = '';
            if (player.isCustomPic && player.profilePic && player.profilePic.startsWith('data:')) {
                profilePicDisplay = `<img src="${player.profilePic}" class="w-24 h-24 rounded-full mx-auto object-cover border-4 border-gray-200 mb-3" alt="Profile">`;
            } else {
                profilePicDisplay = `<div class="w-24 h-24 rounded-full bg-gray-300 border-4 border-gray-200 mx-auto mb-3"></div>`;
            }
            
            content.innerHTML = `
                <div class="text-center mb-6">
                    ${profilePicDisplay}
                    <h2 class="text-2xl font-bold text-gray-800 mb-1">${player.displayName}</h2>
                    ${player.favoriteTeam ? `<p class="text-blue-600 font-medium">üíô ${player.favoriteTeam} Fan</p>` : ''}
                    <p class="text-sm text-gray-500">Joined: ${joinDate}</p>
                </div>
                
                <div class="space-y-4">
                    ${seasonStatus}
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-gray-800">${roundsSurvived}</div>
                            <div class="text-sm text-gray-600">Rounds Survived</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-gray-800">${player.usedTeams.length}</div>
                            <div class="text-sm text-gray-600">Teams Used</div>
                        </div>
                    </div>
                    
                    <div class="bg-white border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-800 mb-3">Pick History</h3>
                        <div class="max-h-32 overflow-y-auto">
                            ${pickHistory}
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.add('hidden');
        }

        function openSettingsModal() {
            if (!currentUser) return;
            
            const modal = document.getElementById('settingsModal');
            
            document.getElementById('settingsDisplayName').value = currentUser.displayName;
            document.getElementById('settingsFavoriteTeam').value = currentUser.favoriteTeam || '';
            
            if (currentUser.isCustomPic && currentUser.profilePic && currentUser.profilePic.startsWith('data:')) {
                document.getElementById('settingsCustomPicImage').src = currentUser.profilePic;
                document.getElementById('settingsCustomPicPreview').classList.remove('hidden');
                window.tempCustomPic = currentUser.profilePic;
            } else {
                document.getElementById('settingsCustomPicPreview').classList.add('hidden');
                window.tempCustomPic = null;
            }
            
            modal.classList.remove('hidden');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        function saveSettings(e) {
            e.preventDefault();
            
            if (!currentUser) return;
            
            const newDisplayName = document.getElementById('settingsDisplayName').value.trim();
            const newFavoriteTeam = document.getElementById('settingsFavoriteTeam').value;
            
            if (!newDisplayName) {
                showNotification('Display name cannot be empty', 'error');
                return;
            }
            
            if (containsProfanity(newDisplayName)) {
                showNotification('Display name contains inappropriate language. Please choose a different name.', 'error');
                return;
            }
            
            let newProfilePic = currentUser.profilePic;
            let isCustomPic = false;
            
            if (window.tempCustomPic) {
                newProfilePic = window.tempCustomPic;
                isCustomPic = true;
            } else {
                newProfilePic = null;
                isCustomPic = false;
            }
            
            currentUser.displayName = newDisplayName;
            currentUser.favoriteTeam = newFavoriteTeam;
            currentUser.profilePic = newProfilePic;
            currentUser.isCustomPic = isCustomPic;
            
            const playerIndex = gameData.players.findIndex(p => p.id === currentUser.id);
            if (playerIndex !== -1) {
                gameData.players[playerIndex] = { ...currentUser };
            }
            
            saveGameData();
            updateUI();
            refreshHeaderUserBadge();
            populateAdminPlayers();
            closeSettingsModal();
            
            showNotification('Profile updated successfully!', 'success');
        }

        function switchAdminTab(tab) {
            const scoresTab = document.getElementById('adminScoresTab');
            const playersTab = document.getElementById('adminPlayersTab');
            const playoffsTab = document.getElementById('adminPlayoffsTab');
            const scoresSection = document.getElementById('adminScoresSection');
            const playersSection = document.getElementById('adminPlayersSection');
            const playoffsSection = document.getElementById('adminPlayoffsSection');
            
            // Reset all tabs
            scoresTab.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium';
            playersTab.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium';
            playoffsTab.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium';
            scoresSection.classList.add('hidden');
            playersSection.classList.add('hidden');
            playoffsSection.classList.add('hidden');
            
            if (tab === 'scores') {
                scoresTab.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg font-medium';
                scoresSection.classList.remove('hidden');
                populateAdminScores();
            } else if (tab === 'players') {
                playersTab.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg font-medium';
                playersSection.classList.remove('hidden');
                populateAdminPlayers();
            } else if (tab === 'playoffs') {
                playoffsTab.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg font-medium';
                playoffsSection.classList.remove('hidden');
                populateAdminPlayoffs();
            }
        }

        function populateAdminPlayoffs() {
            if (currentUser?.email !== 'sacksjordan@gmail.com') return;
            
            // Load current playoff settings
            if (gameData.semiTeams) {
                document.getElementById('sf1Home').value = gameData.semiTeams.sf1Home || 'TBD';
                document.getElementById('sf1Away').value = gameData.semiTeams.sf1Away || 'TBD';
                document.getElementById('sf2Home').value = gameData.semiTeams.sf2Home || 'TBD';
                document.getElementById('sf2Away').value = gameData.semiTeams.sf2Away || 'TBD';
            }
            
            if (gameData.semiTimes) {
                document.getElementById('sf1Time').value = gameData.semiTimes.sf1Time || '';
                document.getElementById('sf2Time').value = gameData.semiTimes.sf2Time || '';
            }
            
            if (gameData.finalTeams) {
                document.getElementById('finalHome').value = gameData.finalTeams.finalHome || 'TBD';
                document.getElementById('finalAway').value = gameData.finalTeams.finalAway || 'TBD';
            }
            
            if (gameData.finalTimes) {
                document.getElementById('finalTime').value = gameData.finalTimes.finalTime || '';
            }
        }

        function openAdminModal() {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            
            switchAdminTab('scores');
            document.getElementById('adminModal').classList.remove('hidden');
        }

        function closeAdminModal() {
            document.getElementById('adminModal').classList.add('hidden');
        }

        function populateAdminScores() {
            const container = document.getElementById('adminScoreContent');
            const selectedRound = document.getElementById('adminRoundSelector').value;
            const roundData = roundFixtures[selectedRound];
            
            if (!roundData || !roundData.matches) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">No matches found for this round</div>';
                return;
            }
            
            let html = '';
            
            roundData.matches.forEach(game => {
                const currentScore = { homeScore: 0, awayScore: 0 };
                const isFinished = gameData.matchResults[game.id]?.finished || false;
                
                html += `
                    <div class="border rounded-lg p-4 bg-gray-50">
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-3">
                            <h4 class="font-semibold">${game.home} vs ${game.away}</h4>
                            <div class="text-right">
                                <span class="text-sm px-2 py-1 rounded ${isFinished ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                    ${isFinished ? 'Finished' : 'Upcoming'}
                                </span>
                                <div class="text-xs text-gray-500 mt-1">Kick-off: ${game.time}</div>
                                <div class="text-xs text-gray-500">${game.day}</div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Winner</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="setGameWinner('${game.id}', '${game.home}', '${game.away}', ${selectedRound})" 
                                        class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-blue-50 text-sm ${gameData.matchResults[game.id]?.winner === game.home ? 'bg-blue-100 border-blue-500' : ''}">
                                    ${game.home}
                                </button>
                                <button onclick="setGameWinner('${game.id}', '${game.away}', '${game.home}', ${selectedRound})" 
                                        class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-blue-50 text-sm ${gameData.matchResults[game.id]?.winner === game.away ? 'bg-blue-100 border-blue-500' : ''}">
                                    ${game.away}
                                </button>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="markGameFinished('${game.id}', ${selectedRound})" 
                                    class="flex-1 bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 text-sm ${!gameData.matchResults[game.id]?.winner ? 'opacity-50 cursor-not-allowed' : ''}" 
                                    ${!gameData.matchResults[game.id]?.winner ? 'disabled' : ''}>
                                Mark Finished
                            </button>
                            ${isFinished ? `<button onclick="resetGameResult('${game.id}')" 
                                    class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 text-sm">
                                Reset
                            </button>` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function setGameWinner(gameId, winner, loser, roundNum) {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            const status = calculatePickingStatus();
            if (!status.isOpen) {
                showNotification('Cannot set winners outside round open', 'error');
                return;
            }
            
            if (!gameData.matchResults[gameId]) {
                gameData.matchResults[gameId] = {};
            }
            
            gameData.matchResults[gameId].winner = winner;
            gameData.matchResults[gameId].roundNum = roundNum;
            saveGameData();
            populateAdminScores();
            showNotification(`Winner set: ${winner}`, 'info');
        }

        function markGameFinished(gameId, roundNum) {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            // Block finishing until after kickoff time
            const rd = roundFixtures[roundNum];
            const mt = rd?.matches.find(m => m.id === gameId);
            if (mt) {
                const kickoff = parseMatchLondonDate(mt.day, mt.time, new Date().getFullYear());
                if (new Date() < kickoff) {
                    showNotification('You can only finish a match after kickoff', 'error');
                    return;
                }
            }
            
            const result = gameData.matchResults[gameId];
            if (!result || !result.winner) {
                showNotification('Please select a winner first', 'error');
                return;
            }
            
            result.finished = true;
            result.roundNum = roundNum;
            
            // Process eliminations for LMS - check all players who picked teams in this match
            const roundData = roundFixtures[roundNum];
            const match = roundData.matches.find(m => m.id === gameId);
            
            if (match) {
                let eliminatedCount = 0;
                gameData.players.forEach(player => {
                    // LMS elimination logic
                    if (!player.isEliminated && player.currentPick && 
                        (player.currentPick === match.home || player.currentPick === match.away) && 
                        player.currentPick !== result.winner) {
                        
                        player.isEliminated = true;
                        player.eliminatedInRound = parseInt(roundNum);
                        player.eliminatedBy = `${player.currentPick} lost to ${result.winner}`;
                        eliminatedCount++;
                        
                        if (player.id === currentUser?.id) {
                            showNotification(`üíÄ You've been eliminated! ${player.currentPick} lost to ${result.winner}`, 'error');
                        }
                    }
                    
                    // Pick it! stats update
                    if (player.pickItPicks && player.pickItPicks[roundNum] && player.pickItPicks[roundNum][gameId]) {
                        if (!player.pickItStats) {
                            player.pickItStats = {
                                totalPicks: 0,
                                correctPicks: 0,
                                percentage: 0,
                                weeklyMovement: 0,
                                previousRank: null
                            };
                        }
                        
                        const userPick = player.pickItPicks[roundNum][gameId];
                        player.pickItStats.totalPicks++;
                        
                        if (userPick === result.winner) {
                            player.pickItStats.correctPicks++;
                        }
                        
                        // Update percentage
                        player.pickItStats.percentage = (player.pickItStats.correctPicks / player.pickItStats.totalPicks) * 100;
                    }
                });
                
                // Calculate Pick it! leaderboard movements
                updatePickItRankings();
                
                if (eliminatedCount > 0) {
                    showNotification(`Match finished: ${result.winner} wins! ${eliminatedCount} player(s) eliminated.`, 'success');
                } else {
                    showNotification(`Match finished: ${result.winner} wins!`, 'success');
                }
            }
            
            saveGameData();
            updateUI();
            populateAdminScores();
        }

        function updatePickItRankings() {
            const leaderboard = calculatePickItLeaderboard();
            
            gameData.players.forEach(player => {
                if (player.pickItStats) {
                    const currentRank = leaderboard.findIndex(p => p.id === player.id) + 1;
                    const previousRank = player.pickItStats.previousRank;
                    
                    if (previousRank && currentRank > 0) {
                        player.pickItStats.weeklyMovement = previousRank - currentRank;
                    }
                    
                    player.pickItStats.previousRank = currentRank > 0 ? currentRank : null;
                }
            });
        }

        // Recompute Pick It stats from finished results only
        function computeAndUpdatePlayerPickItStats(player) {
            if (!player) return { totalPicks: 0, correctPicks: 0, percentage: 0 };
            const stats = { totalPicks: 0, correctPicks: 0, percentage: 0, weeklyMovement: player.pickItStats?.weeklyMovement || 0, previousRank: player.pickItStats?.previousRank || null };
            const results = gameData.matchResults || {};
            Object.keys(results).forEach(gameId => {
                const res = results[gameId];
                if (!res || !res.finished) return;
                const roundNum = res.roundNum;
                const roundPicks = player.pickItPicks?.[roundNum];
                if (!roundPicks) return;
                const pick = roundPicks[gameId];
                if (!pick) return;
                stats.totalPicks++;
                if (pick === res.winner) stats.correctPicks++;
            });
            stats.percentage = stats.totalPicks > 0 ? (stats.correctPicks / stats.totalPicks) * 100 : 0;
            player.pickItStats = stats;
            return stats;
        }

        function resetGameResult(gameId) {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            
            if (confirm('Reset this match result? This will restore any eliminated players from this match.')) {
                const result = gameData.matchResults[gameId];
                if (result && result.finished) {
                    // Find players who were eliminated by this match and restore them
                    const roundNum = result.roundNum;
                    const roundData = roundFixtures[roundNum];
                    const match = roundData.matches.find(m => m.id === gameId);
                    
                    if (match) {
                        gameData.players.forEach(player => {
                            if (player.isEliminated && player.eliminatedInRound === roundNum && 
                                player.eliminatedBy && player.eliminatedBy.includes(result.winner)) {
                                player.isEliminated = false;
                                delete player.eliminatedInRound;
                                delete player.eliminatedBy;
                            }
                        });
                    }
                    
                    // Reset the match result
                    delete gameData.matchResults[gameId];
                    
                    saveGameData();
                    updateUI();
                    populateAdminScores();
                    showNotification('Match result reset and players restored', 'success');
                }
            }
        }



        function populateAdminPlayers() {
            if (currentUser?.email !== 'sacksjordan@gmail.com') return;
            
            const container = document.getElementById('adminPlayerContent');
            let html = '';
            
            const sortedPlayers = [...gameData.players].sort((a, b) => {
                if (a.isEliminated !== b.isEliminated) {
                    return a.isEliminated ? 1 : -1;
                }
                return a.displayName.localeCompare(b.displayName);
            });
            
            sortedPlayers.forEach(player => {
                const statusClass = player.isEliminated ? 'bg-red-50 border-red-200' : 'bg-green-50 border-green-200';
                const statusIcon = player.isEliminated ? 'üíÄ' : '‚úÖ';
                const statusText = player.isEliminated ? 'ELIMINATED' : 'STANDING';
                
                const roundData = roundFixtures[gameData.currentRound];
                const availableTeams = roundData ? roundData.teams : [];
                
                html += `
                    <div class="border rounded-lg p-4 ${statusClass}">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="font-semibold text-lg">${statusIcon} ${player.displayName}</h4>
                                <p class="text-sm text-gray-600">${player.email}</p>
                                <p class="text-sm font-medium ${player.isEliminated ? 'text-red-600' : 'text-green-600'}">${statusText}</p>
                                ${player.isEliminated && player.eliminatedBy ? `<p class="text-xs text-gray-500 mt-1">${player.eliminatedBy}</p>` : ''}
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-600">Round ${player.roundJoined || 1} player</p>
                                <p class="text-sm text-gray-600">Used ${player.usedTeams.length} teams</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Player Status</label>
                                <div class="flex space-x-2 mb-2">
                                    <button onclick="setPlayerStatus('${player.id}', false)" 
                                            class="px-3 py-1 text-sm rounded ${!player.isEliminated ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700'} hover:opacity-80">
                                        Standing
                                    </button>
                                    <button onclick="setPlayerStatus('${player.id}', true)" 
                                            class="px-3 py-1 text-sm rounded ${player.isEliminated ? 'bg-red-500 text-white' : 'bg-gray-200 text-gray-700'} hover:opacity-80">
                                        Eliminated
                                    </button>
                                </div>
                                ${player.isEliminated ? `
                                    <div class="flex space-x-2">
                                        <select id="eliminatedRound_${player.id}" class="flex-1 text-xs border border-gray-300 rounded px-2 py-1">
                                            ${Array.from({length: 18}, (_, i) => i + 1).map(round => 
                                                `<option value="${round}" ${(player.eliminatedInRound || 1) === round ? 'selected' : ''}>Round ${round}</option>`
                                            ).join('')}
                                        </select>
                                        <button onclick="updateEliminationRound('${player.id}')" 
                                                class="px-2 py-1 text-xs bg-orange-500 text-white rounded hover:bg-orange-600">
                                            Update
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Pick Management</label>
                                <div class="space-y-2">
                                    <div class="flex space-x-2">
                                        <select id="pickRound_${player.id}" class="text-sm border border-gray-300 rounded px-2 py-1">
                                            ${Array.from({length: 18}, (_, i) => i + 1).map(round => 
                                                `<option value="${round}" ${gameData.currentRound === round ? 'selected' : ''}>Round ${round}</option>`
                                            ).join('')}
                                        </select>
                                        <select id="pick_${player.id}" class="flex-1 text-sm border border-gray-300 rounded px-2 py-1">
                                            <option value="">No Pick</option>
                                            ${availableTeams.map(team => 
                                                `<option value="${team}" ${player.currentPick === team ? 'selected' : ''}>${team}</option>`
                                            ).join('')}
                                        </select>
                                        <button onclick="setPlayerPick('${player.id}')" 
                                                class="px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600">
                                            Update
                                        </button>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="resetPickItRound('${player.id}', ${gameData.currentRound})" class="px-3 py-1 text-xs bg-yellow-500 text-white rounded hover:bg-yellow-600">Reset Pick It (Round)</button>
                                        <button onclick="resetPickItAll('${player.id}')" class="px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600">Reset Pick It (All)</button>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="resetPickItRound('${player.id}', ${gameData.currentRound})" class="px-3 py-1 text-xs bg-yellow-500 text-white rounded hover:bg-yellow-600">Reset Pick It (Round)</button>
                                        <button onclick="resetPickItAll('${player.id}')" class="px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600">Reset Pick It (All)</button>
                                    </div>
                                    ${player.currentPick ? `<p class=\"text-xs text-gray-500\">Current Round ${gameData.currentRound}: ${player.currentPick}</p>` : ''}
                                </div>
                            </div>
                        </div>
                        
                        ${player.usedTeams.length > 0 ? `
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <p class="text-sm font-medium text-gray-700 mb-1">Used Teams:</p>
                                <div class="flex flex-wrap gap-1">
                                    ${player.usedTeams.map(team => 
                                        `<span class="px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded">${team}</span>`
                                    ).join('')}
                                </div>
                                <button onclick="clearUsedTeams('${player.id}')" 
                                        class="mt-2 px-3 py-1 text-xs bg-yellow-500 text-white rounded hover:bg-yellow-600">
                                    Clear Used Teams
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function setPlayerStatus(playerId, isEliminated) {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            const status = calculatePickingStatus();
            if (!status.isOpen) {
                showNotification('Admin override disabled outside round open', 'error');
                return;
            }
            
            const player = gameData.players.find(p => p.id == playerId);
            if (!player) return;
            
            const wasEliminated = player.isEliminated;
            player.isEliminated = isEliminated;
            
            if (isEliminated && !wasEliminated) {
                player.eliminatedInRound = gameData.currentRound;
                player.eliminatedBy = 'Admin override';
                showNotification(`${player.displayName} marked as eliminated`, 'info');
            } else if (!isEliminated && wasEliminated) {
                delete player.eliminatedInRound;
                delete player.eliminatedBy;
                showNotification(`${player.displayName} restored to standing`, 'success');
            }
            
            if (player.id === currentUser?.id) {
                currentUser = player;
                if (isEliminated) {
                    showNotification('üíÄ Admin has marked you as eliminated', 'error');
                } else {
                    showNotification('üéâ Admin has restored you to standing!', 'success');
                }
            }
            
            saveGameData();
            updateUI();
            populateAdminPlayers();
        }

        function setPlayerPick(playerId) {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            const status = calculatePickingStatus();
            if (!status.isOpen) {
                showNotification('Admin override disabled outside round open', 'error');
                return;
            }
            
            const player = gameData.players.find(p => p.id == playerId);
            const selectedRound = parseInt(document.getElementById(`pickRound_${playerId}`).value);
            const newPick = document.getElementById(`pick_${playerId}`).value;
            
            if (!player) return;
            
            // Handle current round pick
            if (selectedRound === gameData.currentRound) {
                const oldPick = player.currentPick;
                player.currentPick = newPick || null;
                const startRound = player.roundJoined || 1;
                const roundIndex = Math.max(0, (gameData.currentRound || 1) - startRound);
                if (!Array.isArray(player.usedTeams)) player.usedTeams = [];
                if (newPick) {
                    if (roundIndex < player.usedTeams.length) {
                        player.usedTeams[roundIndex] = newPick;
                    } else if (roundIndex === player.usedTeams.length) {
                        player.usedTeams.push(newPick);
                    } else {
                        while (player.usedTeams.length < roundIndex) player.usedTeams.push(null);
                        player.usedTeams.push(newPick);
                    }
                } else {
                    if (roundIndex < player.usedTeams.length) {
                        player.usedTeams[roundIndex] = null;
                    }
                }
                
                if (oldPick !== newPick) {
                    const pickText = newPick ? `${newPick}` : 'No pick';
                    showNotification(`${player.displayName}'s Round ${selectedRound} pick updated to: ${pickText}`, 'success');
                    
                    if (player.id === currentUser?.id) {
                        currentUser = player;
                        if (newPick) {
                            showNotification(`üîß Admin changed your Round ${selectedRound} pick to: ${newPick}`, 'info');
                        } else {
                            showNotification(`üîß Admin cleared your Round ${selectedRound} pick`, 'info');
                        }
                    }
                }
            } else {
                // Handle Pick it! picks for other rounds
                if (!player.pickItPicks) player.pickItPicks = {};
                if (!player.pickItPicks[selectedRound]) player.pickItPicks[selectedRound] = {};
                
                // For simplicity, we'll just show a message that this would need match-specific handling
                showNotification(`Pick it! management for Round ${selectedRound} requires match-specific selection`, 'info');
                return;
            }
            
            saveGameData();
            updateUI();
            populateAdminPlayers();
        }

        function clearUsedTeams(playerId) {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            
            const player = gameData.players.find(p => p.id == playerId);
            if (!player) return;
            
            if (confirm(`Clear all used teams for ${player.displayName}? This will allow them to pick any team again.`)) {
                player.usedTeams = [];
                showNotification(`${player.displayName}'s used teams cleared`, 'success');
                
                if (player.id === currentUser?.id) {
                    currentUser = player;
                    showNotification('üîß Admin cleared your used teams - you can now pick any team!', 'success');
                }
                
                saveGameData();
                updateUI();
                populateAdminPlayers();
            }
        }

        function updateEliminationRound(playerId) {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            
            const player = gameData.players.find(p => p.id == playerId);
            const newRound = parseInt(document.getElementById(`eliminatedRound_${playerId}`).value);
            
            if (!player) return;
            
            player.eliminatedInRound = newRound;
            showNotification(`${player.displayName}'s elimination round updated to Round ${newRound}`, 'success');
            
            if (player.id === currentUser?.id) {
                currentUser = player;
            }
            
            saveGameData();
            updateUI();
            populateAdminPlayers();
        }

        // Chat removed
        function toggleChat() {}
        function closeChat() {}
        function sendMessage() {}
        function loadChatMessages() {}
        function updateCharCount() {}

        // Playoff management functions
        function updateSemiFinals() {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            
            const sf1Home = document.getElementById('sf1Home').value;
            const sf1Away = document.getElementById('sf1Away').value;
            const sf1Time = document.getElementById('sf1Time').value;
            const sf2Home = document.getElementById('sf2Home').value;
            const sf2Away = document.getElementById('sf2Away').value;
            const sf2Time = document.getElementById('sf2Time').value;
            
            if (!gameData.semiTeams) gameData.semiTeams = {};
            if (!gameData.semiTimes) gameData.semiTimes = {};
            
            gameData.semiTeams.sf1Home = sf1Home;
            gameData.semiTeams.sf1Away = sf1Away;
            gameData.semiTeams.sf2Home = sf2Home;
            gameData.semiTeams.sf2Away = sf2Away;
            gameData.semiTimes.sf1Time = sf1Time;
            gameData.semiTimes.sf2Time = sf2Time;
            
            // Update the fixtures
            roundFixtures[17].matches[0].home = sf1Home;
            roundFixtures[17].matches[0].away = sf1Away;
            roundFixtures[17].matches[0].time = sf1Time;
            roundFixtures[17].matches[1].home = sf2Home;
            roundFixtures[17].matches[1].away = sf2Away;
            roundFixtures[17].matches[1].time = sf2Time;
            
            saveGameData();
            showNotification('Semi Finals updated successfully!', 'success');
        }

        function updateFinal() {
            if (currentUser?.email !== 'sacksjordan@gmail.com') {
                showNotification('Access denied - Admin only', 'error');
                return;
            }
            
            const finalHome = document.getElementById('finalHome').value;
            const finalAway = document.getElementById('finalAway').value;
            const finalTime = document.getElementById('finalTime').value;
            
            if (!gameData.finalTeams) gameData.finalTeams = {};
            if (!gameData.finalTimes) gameData.finalTimes = {};
            
            gameData.finalTeams.finalHome = finalHome;
            gameData.finalTeams.finalAway = finalAway;
            gameData.finalTimes.finalTime = finalTime;
            
            // Update the fixtures
            roundFixtures[18].matches[0].home = finalHome;
            roundFixtures[18].matches[0].away = finalAway;
            roundFixtures[18].matches[0].time = finalTime;
            
            saveGameData();
            showNotification('Final updated successfully!', 'success');
        }

        // Password reset functions
        function showPasswordReset() {
            document.getElementById('passwordResetForm').classList.remove('hidden');
            document.getElementById('forgotPasswordBtn').style.display = 'none';
        }

        function hidePasswordReset() {
            document.getElementById('passwordResetForm').classList.add('hidden');
            document.getElementById('forgotPasswordBtn').style.display = 'block';
            // Clear form fields
            document.getElementById('resetEmail').value = '';
            document.getElementById('resetDisplayName').value = '';
            document.getElementById('newPassword').value = '';
        }

        function resetPassword() {
            const email = document.getElementById('resetEmail').value.trim();
            const displayName = document.getElementById('resetDisplayName').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            
            if (!email || !displayName || !newPassword) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('New password must be at least 6 characters long', 'error');
                return;
            }
            
            // Find player by email and display name for security
            const player = gameData.players.find(p => 
                p.email.toLowerCase() === email.toLowerCase() && 
                p.displayName.toLowerCase() === displayName.toLowerCase()
            );
            
            if (!player) {
                showNotification('No account found with that email and display name combination', 'error');
                return;
            }
            
            // Update password
            player.password = newPassword;
            saveGameData();
            
            hidePasswordReset();
            showNotification('Password reset successfully! You can now login with your new password.', 'success');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full`;
            
            const bgColor = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'info': 'bg-blue-500',
                'warning': 'bg-yellow-500'
            }[type] || 'bg-gray-500';
            
            notification.className += ` ${bgColor} text-white`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 5000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'984addaa85f954c9',t:'MTc1ODgwNjkxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script>
  function togglePicks() {
    const picks = document.querySelectorAll('.player-pick');
    picks.forEach(pick => {
      pick.classList.toggle('blur');
    });
  }
</script></body>
</html>
